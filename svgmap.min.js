/*!
 *
 *    svgmap - a simple toolset that helps creating interactive thematic maps
 *    Copyright (C) 2011  Gregor Aisch
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation, either version 3 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 
 */(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz=Object.prototype.hasOwnProperty,bA=function(a,b){function d(){this.constructor=a}for(var c in b)bz.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bi=bc.svgmap)!=null?bi:bc.svgmap={},b=function(){function a(a,b,c,d){var e;a==null&&(a=0),b==null&&(b=0),c==null&&(c=null),d==null&&(d=null),e=this,c===null?(e.xmin=Number.MAX_VALUE,e.xmax=Number.MAX_VALUE*-1):(e.xmin=e.left=a,e.xmax=e.right=a+c,e.width=c),d===null?(e.ymin=Number.MAX_VALUE,e.ymax=Number.MAX_VALUE*-1):(e.ymin=e.top=b,e.ymax=e.bottom=d+b,e.height=d);return}a.prototype.update=function(a,b){var c;b==null&&(b=a[1],a=a[0]),c=this,c.xmin=Math.min(c.xmin,a),c.ymin=Math.min(c.ymin,b),c.xmax=Math.max(c.xmax,a),c.ymax=Math.max(c.ymax,b),c.left=c.xmin,c.top=c.ymin,c.right=c.xmax,c.bottom=c.ymax,c.width=c.xmax-c.xmin,c.height=c.ymax-c.ymin;return this},a.prototype.intersects=function(a){return a.left<s.right&&a.right>s.left&&a.top<s.bottom&&a.bottom>s.top},a.prototype.inside=function(a,b){var c;c=this;return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom},a.prototype.join=function(a){var b;b=this,b.update(a.left,a.top),b.update(a.right,a.bottom);return this};return a}(),b.fromXML=function(a){var b,c,d,e;d=Number(a.getAttribute("x")),e=Number(a.getAttribute("y")),c=Number(a.getAttribute("w")),b=Number(a.getAttribute("h"));return new bd.BBox(d,e,c,b)},bd.BBox=b,"svgmap - a simple toolset that helps creating interactive thematic maps\nCopyright (C) 2011  Gregor Aisch\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.",bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(br=bc.svgmap)!=null?br:bc.svgmap={},(bs=bd.geom)==null&&(bd.geom={}),(bt=(bg=bd.geom).clipping)==null&&(bg.clipping={}),l=function(){function f(){}var a,b,c,d,e;b=0,c=1,d=2,a=4,e=8,f.prototype.compute_out_code=function(a,b,c){var d,e;e=this,d=e.INSIDE,b<a.left?d|=e.LEFT:b>a.right&&(d|=e.RIGHT),c<a.top?d|=e.TOP:c>a.bottom&&(d|=e.BOTTOM);return d},f.prototype.clip=function(a,b,c,d,e){var f,g,h,i,j,k,l;j=this,g=j.compute_out_code(a,b,c),h=j.compute_out_code(a,d,e),f=False;while(True){if(!(g|h)){f=True;break}if(g&h)break;i=code===0?h:g,i&j.TOP?(k=b+(d-b)*(a.top-c)/(e-c),l=a.top):i&j.BOTTOM?(k=b+(d-b)*(a.bottom-c)/(e-c),l=a.bottom):i&j.RIGHT?(l=c+(e-c)*(a.right-b)/(d-b),k=a.right):i&j.LEFT&&(l=c+(e-c)*(a.left-b)/(d-b),k=a.left),i===g?(b=k,c=l,g=j.compute_out_code(a,b,c)):(d=k,e=l,h=j.compute_out_code(a,d,e))}return f?[b,c,d,e]:null};return f}(),bd.geom.clipping.CohenSutherland=l,bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bu=bc.svgmap)!=null?bu:bc.svgmap={},(bv=bd.color)==null&&(bd.color={}),m=function(){function a(b,c,d,e){var f,g;f=this,b==null&&c==null&&d==null&&e==null&&(b=[0,1,1]),typeof b=="object"&&b.length===3&&(e=c,g=b,b=g[0],c=g[1],d=g[2]),typeof b=="string"&&b.length===7?e="hex":e==null&&(e="hsl"),e==="rgb"?f.rgb=[b,c,d]:e==="hsl"?f.rgb=a.hsl2rgb(b,c,d):e==="hsv"?f.rgb=a.hsv2rgb(b,c,d):e==="hex"&&(f.rgb=a.hex2rgb(b))}a.prototype.hex=function(){return a.rgb2hex(this.rgb)},a.prototype.toString=function(){return this.hex()},a.prototype.hsl=function(){return a.rgb2hsl(this.rgb)},a.prototype.hsv=function(){return a.rgb2hsv(this.rgb)},a.prototype.interpolate=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;l=this,d==null&&(d="hsl");if(d==="hsl"||d==="hsv"){d==="hsl"?(p=l.hsl(),q=c.hsl()):d==="hsv"&&(p=l.hsv(),q=c.hsv()),g=p[0],n=p[1],j=p[2],h=q[0],o=q[1],k=q[2];if(!isNaN(g)&&!isNaN(h))h>g&&h-g>180?e=h-(g+360):h<g&&g-h>180?e=h+360-g:e=h-g,f=g+b*e;else if(!isNaN(g)){f=g;if(k===1||k===0)m=n}else if(!isNaN(h)){f=h;if(j===1||j===0)m=o}else f=void 0;m==null&&(m=n+b*(o-n)),i=j+b*(k-j);return new a(f,m,i,d)}if(d==="rgb"){p=l.rgb,q=c.rgb;return new a(p[0]+b*(q[0]-p[0]),p[1]+b*(q[1]-p[1]),p[2]+b*(q[2]-p[2]),d)}throw"color mode "+d+" is not supported"};return a}(),m.hex2rgb=function(a){var b,c,d,e;e=parseInt(a.substr(1),16),d=e>>16,c=e>>8&255,b=e&255;return[d,c,b]},m.rgb2hex=function(a,b,c){var d,e,f;a!==void 0&&a.length===3&&(f=a,a=f[0],b=f[1],c=f[2]),e=a<<16|b<<8|c,d="000000"+e.toString(16).toUpperCase();return"#"+d.substr(d.length-6)},m.hsv2rgb=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;a!==void 0&&a.length===3&&(q=a,a=q[0],b=q[1],h=q[2]),c*=255;if(b===0&&isNaN(a))k=f=d=c;else{a===360&&(a=0),a/=60,g=Math.floor(a),e=a-g,i=c*(1-b),j=c*(1-b*e),l=c*(1-b*(1-e));switch(g){case 0:r=[c,l,i],k=r[0],f=r[1],d=r[2];break;case 1:s=[j,c,i],k=s[0],f=s[1],d=s[2];break;case 2:m=[i,c,l],k=m[0],f=m[1],d=m[2];break;case 3:n=[i,j,c],k=n[0],f=n[1],d=n[2];break;case 4:o=[l,i,c],k=o[0],f=o[1],d=o[2];break;case 5:p=[c,i,j],k=p[0],f=p[1],d=p[2]}}return[k,f,d]},m.rgb2hsv=function(a,b,c){var d,e,f,g,h,i,j;a!==void 0&&a.length===3&&(j=a,a=j[0],b=j[1],c=j[2]),g=Math.min(a,b,c),f=Math.max(a,b,c),d=f-g,console.log(a,b,c,g,f,d),i=f/255,h=d/f,h===0?(e=void 0,h=0):(a===f&&(e=(b-c)/d),b===f&&(e=2+(c-a)/d),c===f&&(e=4+(a-b)/d),e*=60,e<0&&(e+=360));return[e,h,i]},m.hsl2rgb=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;a!==void 0&&a.length===3&&(l=a,a=l[0],b=l[1],c=l[2]);if(b===0)h=f=d=c*255;else{k=[0,0,0],e=[0,0,0],j=c<.5?c*(1+b):c+b-c*b,i=2*c-j,a/=360,k[0]=a+1/3,k[1]=a,k[2]=a-1/3;for(g=0;g<=2;g++)k[g]<0&&(k[g]+=1),k[g]>1&&(k[g]-=1),6*k[g]<1?e[g]=i+(j-i)*6*k[g]:2*k[g]<1?e[g]=j:3*k[g]<2?e[g]=i+(j-i)*(2/3-k[g])*6:e[g]=i;m=[Math.round(e[0]*255),Math.round(e[1]*255),Math.round(e[2]*255)],h=m[0],f=m[1],d=m[2]}return[h,f,d]},m.rgb2hsl=function(a,b,c){var d,e,f,g,h,i;a!==void 0&&a.length===3&&(i=a,a=i[0],b=i[1],c=i[2]),a/=255,b/=255,c/=255,g=Math.min(a,b,c),f=Math.max(a,b,c),e=(f+g)/2,f===g?(h=0,d=void 0):h=e<.5?(f-g)/(f+g):(f-g)/(2-f-g),a===f?d=(b-c)/(f-g):b===f?d=2+(c-a)/(f-g):c===f&&(d=4+(a-b)/(f-g)),d*=60,d<0&&(d+=360);return[d,h,e]},m.hsl=function(a,b,c){return new m(a,b,c,"hsl")},m.rgb=function(a,b,c){return new m(a,b,c,"rgb")},m.hex=function(a){return new m(a)},bd.color.Color=m,n=function(){function a(a,b,c,d){var e,f,g;d==null&&(d="#cccccc"),f=this;for(e=0,g=a.length-1;0<=g?e<=g:e>=g;0<=g?e++:e--)typeof a[e]=="string"&&(a[e]=new m(a[e]));f.colors=a,f.pos=b,f.mode=c,f.nacol=d,f}a.prototype.getColor=function(a){var b,c,d,e,f,g,h;f=this;if(isNaN(a))return f.nacol;a=f.classifyValue(a),c=d=(a-f.min)/(f.max-f.min),c=Math.min(1,Math.max(0,c));for(e=0,h=f.pos.length-1;0<=h?e<=h:e>=h;0<=h?e++:e--){g=f.pos[e];if(c<=g){b=f.colors[e];break}if(c>=g&&e===f.pos.length-1){b=f.colors[e];break}if(c>g&&c<f.pos[e+1]){c=(c-g)/(f.pos[e+1]-g),b=f.colors[e].interpolate(c,f.colors[e+1],f.mode);break}}return b},a.prototype.setClasses=function(a,b,c){var d;a==null&&(a=5),b==null&&(b="equalinterval"),c==null&&(c=[]),d=this,d.classMethod=b,d.numClasses=a,d.classLimits=c;return d},a.prototype.parseData=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;o=this,i=Number.MAX_VALUE,g=Number.MAX_VALUE*-1,p=0,r=[];for(e in a){n=a[e],q=b!=null?n[b]:n;if(!o.validValue(q))continue;i=Math.min(i,q),g=Math.max(g,q),r.push(q),p+=q}r=r.sort(),r.length%2===1?o.median=r[Math.floor(r.length*.5)]:(c=r.length*.5,o.median=r[c-1]*.5+r[c]*.5),o.values=r,o.mean=p/r.length,o.min=i,o.max=g,h=o.classMethod,j=o.numClasses,f=o.classLimits;if(h!=null){if(h==="equalinterval")for(d=1,s=j-1;1<=s?d<=s:d>=s;1<=s?d++:d--)f.push(i+d/j*(g-i));else if(h==="quantiles")for(d=1,t=j-1;1<=t?d<=t:d>=t;1<=t?d++:d--)k=r.length*d/j,l=Math.floor(k),l===k?f.push(r[l]):(m=k-l,f.push(r[l]*m+r[l+1]*(1-m)));f.unshift(i),f.push(g)}},a.prototype.classifyValue=function(a){var b,c,d,e,f,g;g=this,c=g.classLimits,c!=null&&(f=c.length(-1),b=g.getClass(a),a=c[b]+(c[b+1]-c[b])*.5,e=c[0]+(c[1]-c[0])*.3,d=c[f-1]+(c[f]-c[f-1])*.7,a=g.min+(a-e)/(d-e)*(g.max-g.min));return a},a.prototype.getClass=function(a){var b,c,d,e;e=this,c=e.classLimits;if(c!=null){d=c.length-1,b=0;while(b<d&&a>=c[b])b++;return b-1}},a.prototype.validValue=function(a){return!isNaN(a)};return a}(),(bw=(bh=bd.color).scale)==null&&(bh.scale={}),S=function(){function a(b,c,d){b==null&&(b="#fe0000"),c==null&&(c="#feeeee"),d==null&&(d="hsl"),a.__super__.constructor.call(this,[b,c],[0,1],d)}bA(a,n);return a}(),bd.color.scale.Ramp=S,q=function(){function a(b,c,d,e,f){var g;b==null&&(b="#d73027"),c==null&&(c="#ffffbf"),d==null&&(d="#1E6189"),e==null&&(e="mean"),f==null&&(f="hsl"),g=this,g.mode=f,g.center=e,a.__super__.constructor.call(this,[b,c,d],[0,.5,1],f)}bA(a,n),a.prototype.parseData=function(b,c){var d,e;a.__super__.parseData.call(this,b,c),e=this,d=e.center,d==="median"?d=e.median:d==="mean"&&(d=e.mean);return e.pos[1]=(d-e.min)/(e.max-e.min)};return a}(),bd.color.scale.Diverging=q,j=function(){function a(a){var b;b=this,b.colors=a}bA(a,n),a.prototype.parseData=function(a,b){},a.prototype.getColor=function(a){var b;b=this;return b.colors.hasOwnProperty(a)?b.colors[a]:"#cccccc"},a.prototype.validValue=function(a){return this.colors.hasOwnProperty(a)};return a}(),bd.color.scale.Categories=j,bd.color.scale.COOL=new S(m.hsl(180,1,.9),m.hsl(250,.7,.4)),bd.color.scale.HOT=new n(["#000000","#ff0000","#ffff00","#ffffff"],[0,.25,.75,1],"rgb"),bd.color.scale.BWO=new q(m.hsl(30,1,.55),"#ffffff",new m(220,1,.55)),bd.color.scale.GWP=new q(m.hsl(120,.8,.4),"#ffffff",new m(280,.8,.4)),h=function(){function a(a){var b;b=this,b.name=a,b.setClasses(7),b}bA(a,n),a.prototype.getColor=function(a){var b,c;c=this,b=c.getClass(a);return c.name+" l"+c.numClasses+" c"+b};return a}(),bd.color.scale.CSSColors=h,bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bx=bc.svgmap)!=null?bx:bc.svgmap={},ba=(by=bd.filter)!=null?by:bd.filter={},v=function(){function a(a){this.params=a!=null?a:{}}a.prototype.getFilter=function(a){var b,c;c=this,b=c.SVG("filter",{id:a}),c.buildFilter(b);return b},a.prototype._getFilter=function(){throw"not implemented"},a.prototype.SVG=function(a,b){var c,d;typeof a=="string"&&(a=window.document.createElementNS("http://www.w3.org/2000/svg",a));if(b)for(c in b)d=b[c],a.setAttribute(c,d);return a};return a}(),e=function(){function a(){a.__super__.constructor.apply(this,arguments)}bA(a,v),a.prototype.buildFilter=function(a){var b,c,d;d=this,b=d.SVG,c=b("feGaussianBlur",{stdDeviation:d.params.size||4,result:"blur"});return a.appendChild(c)};return a}(),ba.blur=e,x=function(){function a(){a.__super__.constructor.apply(this,arguments)}bA(a,v),a.prototype.buildFilter=function(a){var b,c,d,e,f,g,h,i,j,k;g=this,b=g.SVG,k=g.params.size||8,d=g.params.color||"#D1BEB0",typeof d=="string"&&(d=new bd.color.Color(d)),j=d.rgb,f=b("feColorMatrix",{"in":"SourceGraphic",type:"matrix",values:"0 0 0 0 0   0 0 0 0 0   0 0 0 0 0   0 0 0 500 0",result:"mask"}),a.appendChild(f),i=b("feMorphology",{"in":"mask",radius:k,operator:"erode",result:"r1"}),a.appendChild(i),c=b("feGaussianBlur",{"in":"r1",stdDeviation:k,result:"r2"}),a.appendChild(c),f=b("feColorMatrix",{type:"matrix","in":"r2",values:"1 0 0 0 "+j[0]/255+" 0 1 0 0 "+j[1]/255+" 0 0 1 0 "+j[2]/255+" 0 0 0 -1 1",result:"r3"}),a.appendChild(f),e=b("feComposite",{operator:"in","in":"r3",in2:"mask",result:"comp"}),a.appendChild(e),h=b("feMerge"),h.appendChild(b("feMergeNode",{"in":"SourceGraphic"})),h.appendChild(b("feMergeNode",{"in":"comp"}));return a.appendChild(h)};return a}(),ba.glow=x,bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bj=bc.svgmap)!=null?bj:bc.svgmap={},G=function(){function a(a,b,c){c==null&&(c=0),this.lon=Number(a),this.lat=Number(b),this.alt=Number(c)}a.prototype.distance=function(a){var b,c,d,e,f,g,h,i,j;j=this,b=6371,g=Math.PI/180,e=(a.lat-j.lat)*g,f=(a.lon-j.lon)*g,h=j.lat*g,i=a.lat*g,c=Math.sin(e/2)*Math.sin(e/2)+Math.sin(f/2)*Math.sin(f/2)*Math.cos(h)*Math.cos(i),d=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return b*d};return a}(),E=function(){function a(b,c,d){d==null&&(d=0),a.__super__.constructor.call(this,c,b,d)}bA(a,G);return a}(),bd.LonLat=G,bd.LatLon=E,bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bk=bc.svgmap)!=null?bk:bc.svgmap={},(bl=bd.marker)==null&&(bd.marker={}),K=function(){function a(a){var b;b=this,a.length===2&&(a=new bd.LonLat(a[0],a[1])),b.lonlat=a,b.visible=!0}a.prototype.render=function(a,b,c,d){};return a}(),bd.marker.MapMarker=K,C=function(){function a(b,c){a.__super__.constructor.call(this,b),this.label=c}bA(a,K);return a}(),bd.marker.LabelMarker=C,r=function(){function a(b,c,d){a.__super__.constructor.call(this,b,c),this.rad=d}bA(a,C),a.prototype.render=function(a,b,c,d){var e;e=d.circle(a,b,this.rad).node,e.setAttribute("class","dotMarker");return e.setAttribute("title",this.label)};return a}(),bd.marker.DotMarker=r,z=function(){function a(a,b){}bA(a,K);return a}(),bd.marker.IconMarker=z,D=function(){function a(b){var c,d,e,f;c=this,a.__super__.constructor.call(this,b.ll),c.icon_src=b.icon,c.label_txt=b.label,c.className=(d=b.className)!=null?d:"marker",c.dx=(e=b.dx)!=null?e:0,c.dy=(f=b.dy)!=null?f:0}bA(a,K),a.prototype.render=function(a,b,c,d){var e;e=this,e.markerDiv||(e.icon=$('<img src="'+e.icon_src+'" class="icon"/>'),e.label=$('<div class="label">'+e.label_txt+"</div>"),e.markerDiv=$('<div class="'+e.className+'" />'),e.markerDiv.append(e.icon),e.markerDiv.append(e.label),c.append(e.markerDiv));return e.markerDiv.css({position:"absolute",left:a+e.dx+"px",top:b+e.dy+"px"})};return a}(),bd.marker.LabeledIconMarker=D,f=function(){function a(b,c,d){d==null&&(d="bubble"),a.__super__.constructor.call(this,b)}bA(a,K);return a}(),bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bm=bc.svgmap)!=null?bm:bc.svgmap={},(bn=bd.geom)==null&&(bd.geom={}),P=function(){function a(a,b,c){var d;c==null&&(c=!0),d=this,d.type=a,d.contours=b,d.closed=c}a.prototype.clipToBBox=function(a){throw"path clipping is not implemented yet"},a.prototype.toSVG=function(a){var b;b=this.svgString();return a.path(b)},a.prototype.svgString=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;d=this,e="",c=d.closed?"Z M":"M",l=d.contours;for(h=0,j=l.length;h<j;h++){a=l[h],b=!0,e+=e===""?"M":c;for(i=0,k=a.length;i<k;i++)m=a[i],f=m[0],g=m[1],b||(e+="L"),e+=f+","+g,b=!1}d.closed&&(e+="Z");return e};return a}(),bd.geom.Path=P,k=function(){function a(b,c,d){this.x=b,this.y=c,this.r=d,a.__super__.constructor.call(this,"circle",null,!0)}bA(a,P),a.prototype.toSVG=function(a){var b;b=this;return a.circle(b.x,b.y,b.r)};return a}(),bd.geom.Circle=k,P.fromSVG=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;e=[],m=a.nodeName,k=null;if(m==="path"){h=a.getAttribute("d").trim(),b=h[h.length-1]==="Z",l=b?"Z M":"M",h=h.substring(1,h.length-(b?1:0)),t=h.split(l);for(p=0,r=t.length;p<r;p++){d=t[p],c=[];if(d!==""){u=d.split("L");for(q=0,s=u.length;q<s;q++)i=u[q],v=i.split(","),n=v[0],o=v[1],c.push([Number(n),Number(o)]);e.push(c)}}k=new bd.geom.Path(m,e,b)}else m==="circle"&&(f=a.getAttribute("cx"),g=a.getAttribute("cy"),j=a.getAttribute("r"),k=new bd.geom.Circle(f,g,j));return k},F=function(){function a(a){this.points=a}a.prototype.clipToBBox=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;l=this,c=(new bd.geom.clipping.CohenSutherland).clip,k=[],f=[],e=!1;for(d=0,q=l.points.length-2;0<=q?d<=q:d>=q;0<=q?d++:d--){r=l.points[d],g=r[0],h=r[1],s=l.points[d+1],i=s[0],j=s[1];try{t=c(b,g,h,i,j),m=t[0],o=t[1],n=t[2],p=t[3],e=!0,k.push([m,o]),(i!==n||j!==o||d===len(l.points)-2)&&k.push([n,p])}catch(u){e&&k.length>1&&(f.push(new a(k)),k=[]),e=!1}}k.length>1&&f.push(new a(k));return f},a.prototype.toSVG=function(){var a,b,c,d,e,f,g,h;b=this,a=[],g=b.points;for(e=0,f=g.length;e<f;e++)h=g[e],c=h[0],d=h[1],a.push(c+","+d);return"M"+a.join("L")};return a}(),bd.geom.Line=F,bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bo=bc.svgmap)!=null?bo:bc.svgmap={},bf=bd.proj={},Function.prototype.bind=function(a){var b;b=this;return function(){return b.apply(a,arguments)}},Q=function(){function a(a){var b,c,d;b=this,b.lon0=(c=a.lon0)!=null?c:0,b.lat0=(d=a.lat0)!=null?d:0,b.PI=Math.PI,b.HALFPI=b.PI*.5,b.QUARTERPI=b.PI*.25,b.RAD=b.PI/180,b.DEG=180/b.PI,b.lam0=b.rad(this.lon0),b.phi0=b.rad(this.lat0),b.minLat=-90,b.maxLat=90}a.prototype.rad=function(a){return a*this.RAD},a.prototype.deg=function(a){return a*this.DEG},a.prototype.plot=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;b==null&&(b=!0),f=[],c=!0;for(j=0,k=a.length;j<k;j++)l=a[j],e=l[0],d=l[1],g=this._visible(e,d),g&&(c=!1),m=this.project(e,d),h=m[0],i=m[1],!g&&b?f.push(this._truncate(h,i)):f.push([h,i]);return c?null:[f]},a.prototype.sea=function(){var a,b,c,d,e,f,g,h,i,j;f=this,e=f.project.bind(this),d=[],a=f.lon0,f.lon0=0;for(c=-180;c<=180;c++)d.push(e(c,f.maxLat));for(b=g=f.maxLat,h=f.minLat;g<=h?b<=h:b>=h;g<=h?b++:b--)d.push(e(180,b));for(c=180;c>=-180;c--)d.push(e(c,f.minLat));for(b=i=f.minLat,j=f.maxLat;i<=j?b<=j:b>=j;i<=j?b++:b--)d.push(e(-180,b));f.lon0=a;return d},a.prototype.world_bbox=function(){var a,b,c,d,e,f;b=this.project.bind(this),d=this.sea(),a=new bd.BBox;for(e=0,f=d.length;e<f;e++)c=d[e],a.update(c[0],c[1]);return a};return a}(),Q.fromXML=function(a){var b,c,d,e,f;d=a.getAttribute("id"),e={};for(c=0,f=a.attributes.length-1;0<=f?c<=f:c>=f;0<=f?c++:c--)b=a.attributes[c],b.name!=="id"&&(e[b.name]=b.value);return new bd.proj[d](e)},bd.Proj=Q,p=function(){function a(){a.__super__.constructor.apply(this,arguments)}bA(a,Q),a.prototype._visible=function(a,b){return!0},a.prototype.clon=function(a){a-=this.lon0,a<-180?a+=360:a>180&&(a-=360);return a};return a}(),u=function(){function a(){a.__super__.constructor.apply(this,arguments)}bA(a,p),a.prototype.project=function(a,b){a=this.clon(a);return[a*Math.cos(this.phi0)*1e3,b*-1*1e3]};return a}(),bf.lonlat=u,g=function(){function a(b){var c;a.__super__.constructor.call(this,b),this.lat1=(c=b.lat1)!=null?c:0,this.phi1=this.rad(this.lat1)}bA(a,p),a.prototype.project=function(a,b){var c,d,e,f;c=this.rad(this.clon(a)),d=this.rad(b*-1),e=c*Math.cos(this.phi1),f=Math.sin(d)/Math.cos(this.phi1);return[e*1e3,f*1e3]};return a}(),bf.cea=g,w=function(){function a(b,c){a.__super__.constructor.call(this,b,45)}bA(a,g);return a}(),bf.gallpeters=w,y=function(){function a(b){b.lat0=37.7,a.__super__.constructor.call(this,b)}bA(a,g);return a}(),bf.hobodyer=y,d=function(){function a(b){b.lat0=30,a.__super__.constructor.call(this,b)}bA(a,g);return a}(),bf.behrmann=d,c=function(){function a(b){b.lat0=50,a.__super__.constructor.call(this,b)}bA(a,g);return a}(),bf.balthasart=c,L=function(){function a(b){a.__super__.constructor.call(this,b),this.minLat=-85,this.maxLat=85}bA(a,p),a.prototype.project=function(a,b){var c,d,e,f,g,h;f=this,d=Math,c=f.rad(f.clon(a)),e=f.rad(b*-1),g=c*1e3,h=d.log((1+d.sin(e))/d.cos(e))*1e3;return[g,h]};return a}(),bf.mercator=L,R=function(){function a(){a.__super__.constructor.apply(this,arguments)}bA(a,p);return a}(),N=function(){function a(b){var c;a.__super__.constructor.call(this,b),c=this,c.A0=.8707,c.A1=-0.131979,c.A2=-0.013791,c.A3=.003971,c.A4=-0.001529,c.B0=1.007226,c.B1=.015085,c.B2=-0.044475,c.B3=.028874,c.B4=-0.005916,c.C0=c.B0,c.C1=3*c.B1,c.C2=7*c.B2,c.C3=9*c.B3,c.C4=11*c.B4,c.EPS=1e-11,c.MAX_Y=.8707*.52*Math.PI;return}bA(a,R),a.prototype.project=function(a,b){var c,d,e,f,g,h,i;g=this,c=g.rad(g.clon(a)),d=g.rad(b*-1),e=d*d,f=e*e,h=c*(g.A0+e*(g.A1+e*(g.A2+f*e*(g.A3+e*g.A4))))*180+500,i=d*(g.B0+e*(g.B1+f*(g.B2+g.B3*e+g.B4*f)))*180+270;return[h,i]};return a}(),bf.naturalearth=N,T=function(){function a(b){var c;a.__super__.constructor.call(this,b),c=this,c.X=[1,-5.67239e-12,-0.0000715511,311028e-11,.9986,-0.000482241,-0.000024897,-0.00000133094,.9954,-0.000831031,-0.000044861,-9.86588e-7,.99,-0.00135363,-0.0000596598,367749e-11,.9822,-0.00167442,-0.0000044975,-0.00000572394,.973,-0.00214869,-0.0000903565,1.88767e-8,.96,-0.00305084,-0.0000900732,164869e-11,.9427,-0.00382792,-0.0000653428,-0.00000261493,.9216,-0.00467747,-0.000104566,48122e-10,.8962,-0.00536222,-0.0000323834,-0.00000543445,.8679,-0.00609364,-0.0001139,332521e-11,.835,-0.00698325,-0.0000640219,9.34582e-7,.7986,-0.00755337,-0.0000500038,9.35532e-7,.7597,-0.00798325,-0.0000359716,-0.00000227604,.7186,-0.00851366,-0.000070112,-0.00000863072,.6732,-0.00986209,-0.000199572,191978e-10,.6213,-0.010418,883948e-10,624031e-11,.5722,-0.00906601,181999e-9,624033e-11,.5322,0,0,0],c.Y=[0,.0124,3.72529e-10,1.15484e-9,.062,.0124001,1.76951e-8,-5.92321e-9,.124,.0123998,-7.09668e-8,2.25753e-8,.186,.0124008,2.66917e-7,-8.44523e-8,.248,.0123971,-9.99682e-7,3.15569e-7,.31,.0124108,373349e-11,-0.0000011779,.372,.0123598,-0.000013935,439588e-11,.434,.0125501,520034e-10,-0.0000100051,.4968,.0123198,-0.0000980735,922397e-11,.5571,.0120308,402857e-10,-0.0000052901,.6176,.0120369,-0.0000390662,7.36117e-7,.6769,.0117015,-0.0000280246,-8.54283e-7,.7346,.0113572,-0.0000408389,-5.18524e-7,.7903,.0109099,-0.0000486169,-0.0000010718,.8435,.0103433,-0.0000646934,5.36384e-9,.8936,.00969679,-0.0000646129,-0.00000854894,.9394,.00840949,-0.000192847,-0.00000421023,.9761,.00616525,-0.000256001,-0.00000421021,1,0,0,0],c.NODES=18,c.FXC=.8487,c.FYC=1.3523,c.C1=11.459155902616464,c.RC1=.08726646259971647,c.ONEEPS=1.000001,c.EPS=1e-8;return}bA(a,R),a.prototype._poly=function(a,b,c){return a[b]+c*(a[b+1]+c*(a[b+2]+c*a[b+3]))},a.prototype.project=function(a,b){var c,d,e,f,g,h,i;g=this,a=g.clon(a),d=g.rad(a),e=g.rad(b*-1),f=Math.abs(e),c=Math.floor(f*g.C1),c>=g.NODES&&(c=g.NODES-1),f=g.deg(f-g.RC1*c),c*=4,h=g._poly(g.X,c,f)*g.FXC*d,i=g._poly(g.Y,c,f)*g.FYC,e<0&&(i=-i);return[h,i]};return a}(),bf.robinson=T,t=function(){function a(b){var c;a.__super__.constructor.call(this,b),c=this,c.C_x=.4222382003157712,c.C_y=1.3265004281770023,c.RC_y=.7538633073600218,c.C_p=3.5707963267948966,c.RC_p=.2800495767557787,c.EPS=1e-7,c.NITER=6}bA(a,R),a.prototype.project=function(a,b){var c,d,e,f,g,h,i,j,k,l;h=this,f=h.rad(h.clon(a)),g=h.rad(b*-1),i=h.C_p*Math.sin(g),c=g*g,g*=.895168+c*(.0218849+c*.00826809),e=h.NITER;while(e>0){d=Math.cos(g),j=Math.sin(g),c=(g+j*(d+2)-i)/(1+d*(d+2)-j*j),g-=c;if(Math.abs(c)<h.EPS)break;e-=1}e===0?(k=h.C_x*f,l=g<0?-h.C_y:h.C_y):(k=h.C_x*f*(1+Math.cos(g)),l=h.C_y*Math.sin(g));return[k,l]};return a}(),bf.eckert4=t,W=function(){function a(){a.__super__.constructor.apply(this,arguments)}bA(a,R),a.prototype.project=function(a,b){var c,d,e,f,g;d=this,c=d.rad(d.clon(a)),e=d.rad(b*-1),f=c*Math.cos(e),g=e;return[f,g]};return a}(),bf.sinusoidal=W,M=function(){function a(b,c,d,e,f){var g,h,i,j;c==null&&(c=1.5707963267948966),d==null&&(d=null),e==null&&(e=null),f==null&&(f=null),a.__super__.constructor.call(this,b),g=this,g.MAX_ITER=10,g.TOLERANCE=1e-7,c!=null?(h=c+c,j=Math.sin(c),i=Math.sqrt(Math.PI*2*j/(h+Math.sin(h))),g.cx=2*i/Math.PI,g.cy=i/j,g.cp=h+Math.sin(h)):d!=null&&e!=null&&typeof cz!="undefined"&&cz!==null?(g.cx=d,g.cy=e,g.cp=f):console.error("svgmap.proj.Mollweide: either p or cx,cy,cp must be defined")}bA(a,R),a.prototype.project=function(a,b){var c,d,e,f,g,h,i,j,k,l;h=this,g=Math,c=g.abs,f=h.rad(h.clon(a)),i=h.rad(b),e=h.cp*g.sin(i),d=h.MAX_ITER;while(d!==0){j=(i+g.sin(i)-e)/(1+g.cos(i)),i-=j;if(c(j)<h.TOLERANCE)break;d-=1}d===0?i=i>=0?h.HALFPI:-h.HALFPI:i*=.5,k=1e3*h.cx*f*g.cos(i),l=1e3*h.cy*g.sin(i);return[k,l*-1]};return a}(),bf.mollweide=M,Z=function(){function a(b){a.__super__.constructor.call(this,b,1.0471975511965976)}bA(a,M);return a}(),bf.wagner4=Z,_=function(){function a(b){a.__super__.constructor.call(this,b,null,.90977,1.65014,3.00896)}bA(a,M);return a}(),bf.wagner5=_,H=function(){function c(){c.__super__.constructor.apply(this,arguments)}var a,b;bA(c,R),b=-89,a=89,c.prototype.project=function(a,b){var c,d,e,f,g,h;e=this,d=Math,c=e.rad(e.clon(a)),f=e.rad(b),f===e.phi0?g=c*d.cos(e.phi0):g=c*(f-e.phi0)/(d.log(d.tan(e.QUARTERPI+f*.5))-d.log(d.tan(e.QUARTERPI+e.phi0*.5))),g*=1e3,h=1e3*(f-e.phi0);return[g,h*-1]};return c}(),bf.loximuthal=H,a=function(){function a(b,c){var d;c==null&&(c=1e3),a.__super__.constructor.call(this,b),d=this,d.r=c,d.elevation0=d.to_elevation(d.lat0),d.azimuth0=d.to_azimuth(d.lon0)}bA(a,Q),a.prototype.to_elevation=function(a){var b;b=this;return(a+90)/180*b.PI-b.HALFPI},a.prototype.to_azimuth=function(a){var b;b=this;return(a+180)/360*b.PI*2-b.PI},a.prototype._visible=function(a,b){var c,d,e,f,g;g=this,f=Math,e=g.to_elevation(b),c=g.to_azimuth(a),d=f.sin(e)*f.sin(g.elevation0)+f.cos(g.elevation0)*f.cos(e)*f.cos(c-g.azimuth0);return d>=0},a.prototype._truncate=function(a,b){var c,d,e,f,g;c=Math,d=this.r,e=c.atan2(b-d,a-d),f=d+d*c.cos(e),g=d+d*c.sin(e);return[f,g]},a.prototype.sea=function(){var a,b,c,d;b=[],d=this.r,a=Math;for(c=0;c<=360;c++)b.push([d+a.cos(this.rad(c))*d,d+a.sin(this.rad(c))*d]);return b},a.prototype.world_bbox=function(){var a;a=this.r;return new bd.BBox(0,0,a*2,a*2)};return a}(),O=function(){function b(){b.__super__.constructor.apply(this,arguments)}bA(b,a),b.prototype.project=function(a,b){var c,d,e,f,g,h,i,j;f=this,e=Math,d=f.to_elevation(b),c=f.to_azimuth(a),h=f.r*e.cos(d)*e.sin(c-f.azimuth0),j=-f.r*(e.cos(f.elevation0)*e.sin(d)-e.sin(f.elevation0)*e.cos(d)*e.cos(c-f.azimuth0)),g=f.r+h,i=f.r+j;return[g,i]};return b}(),bf.ortho=O,A=function(){function b(a){b.__super__.constructor.call(this,a),this.scale=Math.sqrt(2)*.5}bA(b,a),b.prototype.project=function(a,b){var c,d,e,f,g,h,i,j,k,l;g=this.rad(b),e=this.rad(a),f=Math,h=f.sin,c=f.cos,d=f.pow(2/(1+h(this.phi0)*h(g)+c(this.phi0)*c(g)*c(e-this.lam0)),.5),d*=this.scale,j=this.r*d*c(g)*h(e-this.lam0),l=-this.r*d*(c(this.phi0)*h(g)-h(this.phi0)*c(g)*c(e-this.lam0)),i=this.r+j,k=this.r+l;return[i,k]};return b}(),bf.laea=A,X=function(){function b(){b.__super__.constructor.apply(this,arguments)}bA(b,a),b.prototype.project=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;h=this.rad(b),f=this.rad(a),g=Math,i=g.sin,c=g.cos,e=.5,d=2*e/(1+i(this.phi0)*i(h)+c(this.phi0)*c(h)*c(f-this.lam0)),k=this.r*d*c(h)*i(f-this.lam0),m=-this.r*d*(c(this.phi0)*i(h)-i(this.phi0)*c(h)*c(f-this.lam0)),j=this.r+k,l=this.r+m;return[j,l]};return b}(),bf.stereo=X,V=function(){function b(a){var c,d,e,f,g,h,i,j;b.__super__.constructor.call(this,{lon0:0,lat0:0}),this.dist=(h=a.dist)!=null?h:3,this.up=this.rad((i=a.up)!=null?i:0),this.tilt=this.rad((j=a.tilt)!=null?j:0),this.scale=1,f=Number.MAX_VALUE,e=Number.MAX_VALUE*-1;for(c=0;c<=179;c++)for(d=0;d<=360;d++)g=this.project(d-180,c-90),f=Math.min(g[0],f),e=Math.max(g[0],e);this.scale=this.r*2/(e-f),b.__super__.constructor.call(this,a);return}bA(b,a),b.prototype.project=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;c==null&&(c=0),m=this.rad(b),k=this.rad(a),l=Math,p=l.sin,f=l.cos,n=this.r,o=n*(c+6371)/3671,g=p(this.phi0)*p(m)+f(this.phi0)*f(m)*f(k-this.lam0),j=(this.dist-1)/(this.dist-g),j=(this.dist-1)/(this.dist-g),j*=this.scale,t=o*j*f(m)*p(k-this.lam0),w=-o*j*(f(this.phi0)*p(m)-p(this.phi0)*f(m)*f(k-this.lam0)),i=f(this.up),r=p(this.up),h=f(this.tilt),q=p(this.tilt),e=o*(this.dist-1),d=(w*i+t*r)*p(this.tilt/e)+h,u=(t*i-w*r)*f(this.tilt/d),x=(w*i+t*r)/d,s=n+u,v=n+x;return[s,v]},b.prototype._visible=function(a,b){var c,d,e,f;e=this.to_elevation(b),c=this.to_azimuth(a),f=Math,d=f.sin(e)*f.sin(this.elevation0)+f.cos(this.elevation0)*f.cos(e)*f.cos(c-this.azimuth0);return d>=1/this.dist},b.prototype.sea=function(){var a,b,c,d;b=[],d=this.r,a=Math;for(c=0;c<=360;c++)b.push([d+a.cos(this.rad(c))*d,d+a.sin(this.rad(c))*d]);return b};return b}(),bf.satellite=V,o=function(){function a(b){var c,d,e;c=this,a.__super__.constructor.call(this,b),c.lat1=(d=b.lat1)!=null?d:30,c.phi1=c.rad(c.lat1),c.lat2=(e=b.lat2)!=null?e:50,c.phi2=c.rad(c.lat2)}bA(a,Q),a.prototype._visible=function(a,b){return!0},a.prototype._truncate=function(a,b){return[a,b]},a.prototype.clon=function(a){a-=this.lon0,a<-180?a+=360:a>180&&(a-=360);return a};return a}(),B=function(){function a(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;l=this,a.__super__.constructor.call(this,b),h=Math,p=[h.sin,h.cos,h.abs,h.log,h.tan,h.pow],m=p[0],e=p[1],c=p[2],g=p[3],o=p[4],j=p[5],l.n=i=n=m(l.phi1),f=e(l.phi1),k=c(l.phi1-l.phi2)>=1e-10,k&&(i=g(f/e(l.phi2))/g(o(l.QUARTERPI+.5*l.phi2)/o(l.QUARTERPI+.5*l.phi1))),l.c=d=f*j(o(l.QUARTERPI+.5*l.phi1),i)/i,c(c(l.phi0)-l.HALFPI)<1e-10?l.rho0=0:l.rho0=d*j(o(l.QUARTERPI+.5*l.phi0),-i),l.minLat=-60,l.maxLat=85}bA(a,o),"Lambert Conformal Conic Projection (spherical)",a.prototype.project=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;m=this,j=m.rad(b),e=m.rad(m.clon(a)),h=Math,r=[h.sin,h.cos,h.abs,h.log,h.tan,h.pow],n=r[0],d=r[1],c=r[2],g=r[3],o=r[4],k=r[5],i=m.n,c(c(j)-m.HALFPI)<1e-10?l=0:l=m.c*k(o(m.QUARTERPI+.5*j),-i),f=e*i,p=1e3*l*n(f),q=1e3*m.rho0-l*d(f);return[p,q*-1]};return a}(),bf.lcc=B,bc=typeof exports!="undefined"&&exports!==null?exports:this,bd=(bp=bc.svgmap)!=null?bp:bc.svgmap={},bd.version="0.1.0",be=function(a){return console.warn("svgmap ("+bd.version+"): "+a)},bb=function(a){return console.log("svgmap ("+bd.version+"): "+a)},U=function(){function a(a){var b,c,d,e;d=this,d.container=c=$(a),d.viewport=e=new bd.BBox(0,0,c.width(),c.height()),d.paper=Raphael(c[0],e.width,e.height),b=$("desc",c).text(),$("desc",c).text(b.replace("with ","with svgmap "+bd.version+" and ")),d.markers=[]}a.prototype.loadMap=function(a,b,c){var d;d=this,d.opts=c!=null?c:{},d.mapLoadCallback=b,$.ajax({url:a,success:d.mapLoaded,context:d})},a.prototype.addLayer=function(a,b,c){var d,e,f,g,h,i,j,k,l;f=this,(k=f.layerIds)==null&&(f.layerIds=[]),(l=f.layers)==null&&(f.layers={}),b==null&&(b=a),g=$("g#"+a,f.svgSrc);if(g.length===0)be("didn't find any paths for layer \""+b+'"');else{e=new I(b,c,f.paper,f.viewBC),d=$("*",g[0]);for(i=0,j=d.length;i<j;i++)h=d[i],e.addPath(h);e.paths.length>0?(f.layers[b]=e,f.layerIds.push(b)):be("didn't find any paths for layer "+b)}},a.prototype.addCanvasLayer=function(a,b){var c,d,e,f,g,h,j,k;f=this,f.canvas==null&&(d=$("<canvas />"),d.css({position:"absolute",top:"0px",left:"0px"}),d.attr({width:f.viewport.width+"px",height:f.viewport.height+"px"}),f.container.append(d),f.canvas=d[0]),g=$("g#"+a,f.svgSrc);if(g.length===0)be("didn't find any paths for layer \""+layer_id+'"');else{e=new i(a,f.canvas,f.viewBC,b),c=$("*",g[0]);for(j=0,k=c.length;j<k;j++)h=c[j],e.addPath(h);return e.render()}},a.prototype.addLayerEvent=function(a,b,c){var d,e,f,g,h,i;d=this,c==null&&(c=d.layerIds[d.layerIds.length-1]),f=d.layers[c].paths,i=[];for(g=0,h=f.length;g<h;g++)e=f[g],i.push($(e.svgPath.node).bind(a,b));return i},a.prototype.addMarker=function(a){var b,c;b=this,b.markers.push(a),c=b.viewBC.project(b.viewAB.project(b.proj.project(a.lonlat.lon,a.lonlat.lat)));return a.render(c[0],c[1],b.container,b.paper)},a.prototype.choropleth=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;h=this,g=(q=a.layer)!=null?q:h.layerIds[h.layerIds.length-1];if(!h.layers.hasOwnProperty(g))be('choropleth error: layer "'+g+'" not found');else{d=a.data,e=a.key,i=(r=a.noDataColor)!=null?r:"#ccc",c=(s=a.colorscale)!=null?s:bd.color.scale.COOL,c.parseData(d,e),k={};for(f in d)m=d[f],k[f]=m[e];t=h.layers[g].pathsById;for(f in t){l=t[f];for(o=0,p=l.length;o<p;o++)j=l[o],k[f]!=null&&c.validValue(k[f])?(n=k[f],b=c.getColor(n),""+b.substr(0,1)=="#"?(j.svgPath.node.setAttribute("style","fill:"+b),j.svgPath.node.setAttribute("class",j.baseClass)):(j.svgPath.node.setAttribute("class",j.baseClass+" "+b),j.svgPath.node.setAttribute("style",""))):j.svgPath.node.setAttribute("style","fill:"+i)}}},a.prototype.tooltips=function(a){var b,c,d,e,f,g,h,i,j,k,l;e=this,h=a.content,d=(j=a.layer)!=null?j:e.layerIds[e.layerIds.length-1];if(!e.layers.hasOwnProperty(d))be('tooltips error: layer "'+d+'" not found');else{
k=e.layers[d].pathsById,l=[];for(c in k)g=k[c],l.push(function(){var a,d,e;e=[];for(a=0,d=g.length;a<d;a++)f=g[a],$.isFunction(h)?i=h(c,f):i=h[c],i!=null?(b={position:{target:"mouse",viewport:$(window),adjust:{x:7,y:7}},show:{delay:20},content:{}},typeof i=="string"?b.content.text=i:$.isArray(i)&&(b.content.title=i[0],b.content.text=i[1]),e.push($(f.svgPath.node).qtip(b))):e.push(void 0);return e}());return l}},a.prototype.display=function(){return this.render()},a.prototype.mapLoaded=function(a){var b,c,d,e,f,g,h,i,j,k;e=this,e.svgSrc=a,h=e.viewport,b=$("view",a)[0],e.viewAB=c=bd.View.fromXML(b),f=(i=e.opts.padding)!=null?i:0,d=(j=e.opts.halign)!=null?j:"center",g=(k=e.opts.valign)!=null?k:"center",e.viewBC=new bd.View(c.asBBox(),h.width,h.height,f,d,g),e.proj=bd.Proj.fromXML($("proj",b)[0]);return e.mapLoadCallback(e)},a.prototype.loadCoastline=function(){var a;a=this;return $.ajax({url:"coastline.json",success:a.renderCoastline,context:a})},a.prototype.renderCoastline=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;f=this,b=f.proj,l=f.viewport,j=f.viewAB,k=f.viewBC,p=[];for(m=0,n=a.length;m<n;m++){e=a[m],i="";for(d=0,o=e.length-2;0<=o?d<=o:d>=o;0<=o?d++:d--){g=e[d],h=e[d+1],c=0;if(b._visible(g[0],g[1])&&b._visible(h[0],h[1])){g=k.project(j.project(b.project(g[0],g[1]))),h=k.project(j.project(b.project(h[0],h[1])));if(l.inside(g[0],g[1])||l.inside(h[0],h[1]))i+="M"+g[0]+","+g[1]+"L"+h[0]+","+h[1]}}i!==""?p.push(f.paper.path(i).attr("opacity",.8)):p.push(void 0)}return p},a.prototype.onPathEvent=function(a){var b,c;b=this,c=a.target.path;return b.layerEventCallbacks[c.layer][a.type](c)},a.prototype.resize=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;e=this,a=e.container,e.viewport=h=new bd.BBox(0,0,a.width(),a.height()),e.paper.setSize(h.width,h.height),h=e.viewport,f=(i=e.opts.padding)!=null?i:0,b=(j=e.opts.halign)!=null?j:"center",g=(k=e.opts.valign)!=null?k:"center",e.viewBC=new bd.View(e.viewAB.asBBox(),h.width,h.height,f,b,g),l=e.layers,m=[];for(c in l)d=l[c],m.push(d.setView(e.viewBC));return m},a.prototype.addFilter=function(a,b,c){var d,e,f;c==null&&(c={}),f=this,d=window.document;if(bd.filter[b]!=null)e=(new bd.filter[b](c)).getFilter(a);else throw"unknown filter type "+b;return f.paper.defs.appendChild(e)},a.prototype.applyFilter=function(a,b){var c;c=this;return $(".polygon."+a,c.paper.canvas).attr({filter:"url(#"+b+")"})},a.prototype.lonlat2xy=function(a){var b,c;c=this,a.length===2&&(a=new bd.LonLat(a[0],a[1])),a.length===3&&(a=new bd.LonLat(a[0],a[1],a[2])),b=c.proj.project(a.lon,a.lat,a.alt);return c.viewBC.project(c.viewAB.project(b))},a.prototype.addGeoPath=function(a,b,c){var d,e,f,g,h,i,j,k;b==null&&(b=[]),c==null&&(c=""),f=this,b.length===0&&b.push("M"),h="";for(e in a)i=a[e],d=(k=b[e])!=null?k:"L",j=f.lonlat2xy(i),h+=d+j[0]+","+j[1];g=f.paper.path(h),g.node.setAttribute("class",c)};return a}(),bd.SVGMap=U,I=function(){function a(a,b,c,d){var e;e=this,e.id=a,e.path_id=b,e.paper=c,e.view=d}a.prototype.addPath=function(a){var b,c,d,e,f,g,h;c=this,(f=c.paths)==null&&(c.paths=[]),b=new J(a,c.id,c.paper,c.view),c.paths.push(b);if(c.path_id!=null){(g=c.pathsById)==null&&(c.pathsById={}),(h=(d=c.pathsById)[e=b.data[c.path_id]])==null&&(d[e]=[]);return c.pathsById[b.data[c.path_id]].push(b)}},a.prototype.setView=function(a){var b,c,d,e,f,g;b=this,f=b.paths,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c.setView(a));return g};return a}(),J=function(){function a(a,b,c,d){var e,f,g,h,i,j;h=this,h.path=i=bd.geom.Path.fromSVG(a),h.svgPath=d.projectPath(i).toSVG(c),h.baseClass="polygon "+b,h.svgPath.node.setAttribute("class",h.baseClass),h.svgPath.node.path=h,f={};for(g=0,j=a.attributes.length-1;0<=j?g<=j:g>=j;0<=j?g++:g--)e=a.attributes[g],e.name.substr(0,5)==="data-"&&(f[e.name.substr(5)]=e.value);h.data=f}a.prototype.setView=function(a){var b,c,d;b=this,c=a.projectPath(b.path);if(b.path.type==="path"){d=c.svgString();return b.svgPath.attr({path:d})}if(b.path.type==="circle")return b.svgPath.attr({cx:c.x,cy:c.y,r:c.r})};return a}(),i=function(){function a(a,b,c,d){var e;e=this,e.layer_id=a,e.canvas=b,e.view=c,e.renderCallback=d}a.prototype.addPath=function(a){var b,c,d;b=this,(d=b.paths)==null&&(b.paths=[]),c=bd.geom.Path.fromSVG(a);return b.paths.push(c)},a.prototype.render=function(){var a,b,c,d,e,f;a=this,c=[],f=a.paths;for(d=0,e=f.length;d<e;d++)b=f[d],c.push(a.view.projectPath(b));return a.renderCallback(a,c)},a.prototype.drawPaths=function(){var a,b,c,d,e,f,g,h,i;c=this,a=c.canvas.getContext("2d"),h=c.paths,i=[];for(f=0,g=h.length;f<g;f++)d=h[f],d=c.view.projectPath(d),i.push(function(){var c,f,g,h;g=d.contours,h=[];for(c=0,f=g.length;c<f;c++)b=g[c],b.reverse(),h.push(function(){var c,d,f;f=[];for(c=0,d=b.length;c<d;c++)e=b[c],e===b[0]?f.push(a.moveTo(e[0],e[1])):f.push(a.lineTo(e[0],e[1]));return f}());return h}());return i};return a}(),Y=function(){function a(a,b,c,d,e,f){var g;g=this,g.bbox=a,g.width=b,g.padding=d!=null?d:0,g.halign=e!=null?e:"center",g.valign=f!=null?f:"center",g.height=c,g.scale=Math.min((b-d*2)/a.width,(c-d*2)/a.height)}a.prototype.project=function(a,b){var c,d,e,f,g,h,i;b==null&&(b=a[1],a=a[0]),e=this,f=e.scale,c=e.bbox,d=e.height,g=e.width,h=e.halign==="center"?(g-c.width*f)*.5:e.halign==="left"?e.padding*f:g-(c.width-e.padding)*f,i=e.valign==="center"?(d-c.height*f)*.5:e.valign==="top"?e.padding*f:0,a=(a-c.left)*f+h,b=(b-c.top)*f+i;return[a,b]},a.prototype.projectPath=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;d=this;if(a.type==="path"){c=[],m=a.contours;for(i=0,k=m.length;i<k;i++){e=m[i],b=[];for(j=0,l=e.length;j<l;j++)n=e[j],g=n[0],h=n[1],o=d.project(g,h),g=o[0],h=o[1],b.push([g,h]);c.push(b)}return new bd.geom.Path(a.type,c,a.closed)}if(a.type==="circle"){p=d.project(a.x,a.y),g=p[0],h=p[1],f=a.r*d.scale;return new bd.geom.Circle(g,h,f)}},a.prototype.asBBox=function(){var a;a=this;return new bd.BBox(0,0,a.width,a.height)};return a}(),Y.fromXML=function(a){var c,d,e,f,g;g=Number(a.getAttribute("w")),e=Number(a.getAttribute("h")),f=Number(a.getAttribute("padding")),d=a.getElementsByTagName("bbox")[0],c=b.fromXML(d);return new bd.View(c,g,e,f)},bc=typeof exports!="undefined"&&exports!==null?exports:this,(bq=bc.svgmap)==null&&(bc.svgmap={}),bc.svgmap.View=Y}).call(this)