/*!
 *
 *    kartograph - a svg mapping library 
 *    Copyright (C) 2011,2012  Gregor Aisch
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation, either version 3 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 
 *//*
    kartograph - a svg mapping library
    Copyright (C) 2011,2012  Gregor Aisch

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/(function(){var e,t,n,r,i,o,u,a,f,l,c,h,p,d,v,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt=function(e,t){return function(){return e.apply(t,arguments)}},Xt={}.hasOwnProperty,Vt=function(e,t){function r(){this.constructor=e}for(var n in t)Xt.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};St=typeof exports!="undefined"&&exports!==null?exports:this,vt=St.$K=window.kartograph=(Mt=St.kartograph)!=null?Mt:St.kartograph={},vt.version="0.2.1",Lt=!1,Tt=function(e){if(Lt)return console.warn("kartograph ("+vt.version+"): ",e)},mt=function(e){if(Lt)return console.log("kartograph ("+vt.version+"): ",e)},(_t=(At=String.prototype).trim)==null&&(At.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),kt=function(){var e,t,n,r,i;e={},i="Boolean Number String Function Array Date RegExp Undefined Null".split(" ");for(n=0,r=i.length;n<r;n++)t=i[n],e["[object "+t+"]"]=t.toLowerCase();return function(t){var n;return n=Object.prototype.toString.call(t),e[n]||"object"}}(),n=function(){function e(e,t,n,r){var i;e==null&&(e=0),t==null&&(t=0),n==null&&(n=null),r==null&&(r=null),i=this,n===null?(i.xmin=Number.MAX_VALUE,i.xmax=Number.MAX_VALUE*-1):(i.xmin=i.left=e,i.xmax=i.right=e+n,i.width=n),r===null?(i.ymin=Number.MAX_VALUE,i.ymax=Number.MAX_VALUE*-1):(i.ymin=i.top=t,i.ymax=i.bottom=r+t,i.height=r);return}return e.prototype.update=function(e,t){var n;return t==null&&(t=e[1],e=e[0]),n=this,n.xmin=Math.min(n.xmin,e),n.ymin=Math.min(n.ymin,t),n.xmax=Math.max(n.xmax,e),n.ymax=Math.max(n.ymax,t),n.left=n.xmin,n.top=n.ymin,n.right=n.xmax,n.bottom=n.ymax,n.width=n.xmax-n.xmin,n.height=n.ymax-n.ymin,this},e.prototype.intersects=function(e){return e.left<s.right&&e.right>s.left&&e.top<s.bottom&&e.bottom>s.top},e.prototype.inside=function(e,t){var n;return n=this,e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom},e.prototype.join=function(e){var t;return t=this,t.update(e.left,e.top),t.update(e.right,e.bottom),this},e}(),n.fromXML=function(e){var t,n,r,i;return r=Number(e.getAttribute("x")),i=Number(e.getAttribute("y")),n=Number(e.getAttribute("w")),t=Number(e.getAttribute("h")),new vt.BBox(r,i,n,t)},vt.BBox=n,(Bt=vt.geom)==null&&(vt.geom={}),(jt=(Ot=vt.geom).clipping)==null&&(Ot.clipping={}),c=function(){function s(){}var e,t,n,r,i;return t=0,n=1,r=2,e=4,i=8,s.prototype.compute_out_code=function(e,t,n){var r,i;return i=this,r=i.INSIDE,t<e.left?r|=i.LEFT:t>e.right&&(r|=i.RIGHT),n<e.top?r|=i.TOP:n>e.bottom&&(r|=i.BOTTOM),r},s.prototype.clip=function(e,t,n,r,i){var s,o,u,a,f,l,c;f=this,o=f.compute_out_code(e,t,n),u=f.compute_out_code(e,r,i),s=False;while(True){if(!(o|u)){s=True;break}if(o&u)break;a=code===0?u:o,a&f.TOP?(l=t+(r-t)*(e.top-n)/(i-n),c=e.top):a&f.BOTTOM?(l=t+(r-t)*(e.bottom-n)/(i-n),c=e.bottom):a&f.RIGHT?(c=n+(i-n)*(e.right-t)/(r-t),l=e.right):a&f.LEFT&&(c=n+(i-n)*(e.left-t)/(r-t),l=e.left),a===o?(t=l,n=c,o=f.compute_out_code(e,t,n)):(r=l,i=c,u=f.compute_out_code(e,r,i))}return s?[t,n,r,i]:null},s}(),vt.geom.clipping.CohenSutherland=c,C=function(){function e(e,t,r){var i,s;s=this,s.container=i=$(e),t==null&&(t=i.width()),r==null&&(r=i.height()),r===0&&(r=t*.5),s.viewport=new n(0,0,t,r),s.paper=s.createSVGLayer(),s.markers=[],s.pathById={},s.container.addClass("kartograph")}return e.prototype.createSVGLayer=function(e){var t,n,r,i,s,o,u,a;return i=this,(a=i._layerCnt)==null&&(i._layerCnt=0),r=i._layerCnt++,u=i.viewport,n=i.container,s=Raphael(n[0],u.width,u.height),o=$(s.canvas),o.css({position:"absolute",top:"0px",left:"0px","z-index":r+5}),n.css("position")==="static"&&n.css({position:"relative",height:u.height+"px"}),o.addClass(e),t=$("desc",s.canvas).text(),$("desc",s.canvas).text(t.replace("with ","with kartograph "+vt.version+" and ")),s},e.prototype.createHTMLLayer=function(e){var t,n,r,i,s,o;return i=this,s=i.viewport,t=i.container,(o=i._layerCnt)==null&&(i._layerCnt=0),r=i._layerCnt++,n=$('<div class="layer '+e+'" />'),n.css({position:"absolute",top:"0px",left:"0px",width:s.width+"px",height:s.height+"px","z-index":r+5}),t.append(n),n},e.prototype.loadMap=function(e,t,n){var r,i,s;r=this,r.clear(),r.opts=n!=null?n:{},(s=(i=r.opts).zoom)==null&&(i.zoom=1),r.mapLoadCallback=t,r._lastMapUrl=e,r.cacheMaps&&vt.__mapCache[e]!=null?r._mapLoaded(vt.__mapCache[e]):$.ajax({url:e,dataType:"text",success:r._mapLoaded,context:r,error:function(e,t,n){return Tt(e,t,n)}})},e.prototype._mapLoaded=function(e){var t,n,r,i,s,o,u,a,f,l,c;i=this,i.cacheMaps&&((a=vt.__mapCache)==null&&(vt.__mapCache={}),vt.__mapCache[i._lastMapUrl]=e);try{e=$(e)}catch(h){Tt("something went horribly wrong while parsing svg");return}return i.svgSrc=e,u=i.viewport,t=$("view",e)[0],i.viewAB=n=vt.View.fromXML(t),s=(f=i.opts.padding)!=null?f:0,r=(l=i.opts.halign)!=null?l:"center",o=(c=i.opts.valign)!=null?c:"center",i.viewBC=new vt.View(n.asBBox(),u.width,u.height,s,r,o),i.proj=vt.Proj.fromXML($("proj",t)[0]),i.mapLoadCallback(i)},e.prototype.addLayer=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;u=this,(m=u.layerIds)==null&&(u.layerIds=[]),(g=u.layers)==null&&(u.layers={}),kt(e)==="object"?(a=e,e=a.id,t=a.className,n=a.key,c=a.title):a={},t==null&&(t=e),f=$("#"+e,u.svgSrc);if(f.length===0)return;o=new H(t,n,u,a.filter),r=$("*",f[0]);for(h=0,d=r.length;h<d;h++)l=r[h],o.addPath(l,c);o.paths.length>0&&(u.layers[t]=o,u.layerIds.push(t)),i=["click"];for(p=0,v=i.length;p<v;p++)s=i[p],kt(a[s])==="function"&&u.onLayerEvent(s,a[s],t);return a.tooltip!=null&&u.tooltips(a.tooltip),u},e.prototype.getLayer=function(e){var t;return t=this,t.layers[e]==null&&Tt("could not find layer "+e),t.layers[e]},e.prototype.getLayerPath=function(e,t){var n;return n=this,n.layers[e]!=null&&n.layers[e].hasPath(t)?n.layers[e].getPath(t):null},e.prototype.onLayerEvent=function(e,t,n){var r,i,s,o,u,a,f,l;s=this,s,n==null&&(n=s.layerIds[s.layerIds.length-1]),r=function(){function e(e,t,n){this.type=e,this.cb=t,this.map=n,this.handle=Wt(this.handle,this)}return e.prototype.handle=function(e){var t;return s=this,t=s.map.pathById[e.target.getAttribute("id")],s.cb(t.data)},e}(),i=new r(e,t,s);if(s.layers[n]!=null){u=s.layers[n].paths,l=[];for(a=0,f=u.length;a<f;a++)o=u[a],l.push($(o.svgPath.node).bind(e,i.handle));return l}},e.prototype.addMarker=function(e){var t,n;return t=this,t.markers.push(e),n=t.viewBC.project(t.viewAB.project(t.proj.project(e.lonlat.lon,e.lonlat.lat))),e.render(n[0],n[1],t.container,t.paper)},e.prototype.clearMarkers=function(){var e,t,n,r,i;t=this,i=t.markers;for(n=0,r=i.length;n<r;n++)e=i[n],e.clear();return t.markers=[]},e.prototype.fadeIn=function(e){var t,n,r,i,s,o,u,a,f,l,c;e==null&&(e={}),s=this,i=(a=e.layer)!=null?a:s.layerIds[s.layerIds.length-1],n=(f=e.duration)!=null?f:500,l=s.layers[i].pathsById,c=[];for(r in l)u=l[r],c.push(function(){var e,r,i;i=[];for(e=0,r=u.length;e<r;e++)o=u[e],kt(n)==="function"?t=n(o.data):t=n,o.svgPath.attr("opacity",0),i.push(o.svgPath.animate({opacity:1},t));return i}());return c},e.prototype.loadCoastline=function(){var e;return e=this,$.ajax({url:"coastline.json",success:e.renderCoastline,context:e})},e.prototype.resize=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;o=this,n=o.container,e==null&&(e=n.width()),t==null&&(t=n.height()),o.viewport=l=new vt.BBox(0,0,e,t),o.paper.setSize(l.width,l.height),l=o.viewport,u=(d=o.opts.padding)!=null?d:0,r=(v=o.opts.halign)!=null?v:"center",f=(m=o.opts.valign)!=null?m:"center",c=o.opts.zoom,o.viewBC=new vt.View(o.viewAB.asBBox(),l.width*c,l.height*c,u,r,f),g=o.layers;for(i in g)s=g[i],s.setView(o.viewBC);if(o.symbolGroups!=null){y=o.symbolGroups;for(h=0,p=y.length;h<p;h++)a=y[h],a.onResize()}},e.prototype.lonlat2xy=function(e){var t,n;return n=this,e.length===2&&(e=new vt.LonLat(e[0],e[1])),e.length===3&&(e=new vt.LonLat(e[0],e[1],e[2])),t=n.proj.project(e.lon,e.lat,e.alt),n.viewBC.project(n.viewAB.project(t))},e.prototype.showZoomControls=function(){var e;return e=this,e.zc=new U(e),e},e.prototype.addSymbolGroup=function(e){var t,n;return t=this,(n=t.symbolGroups)==null&&(t.symbolGroups=[]),t.symbolGroups.push(e)},e.prototype.clear=function(){var e,t,n,r,i,s;t=this;if(t.layers!=null){for(e in t.layers)t.layers[e].remove();t.layers={},t.layerIds=[]}if(t.symbolGroups!=null){s=t.symbolGroups;for(r=0,i=s.length;r<i;r++)n=s[r],n.remove();return t.symbolGroups=[]}},e.prototype.loadStyles=function(e,t){var n;return n=this,$.browser.msie?$.ajax({url:e,dataType:"text",success:function(e){return n.styles=vt.parsecss(e),t()},error:function(t,n,r){return Tt("error while loading "+e,t,n,r)}}):($("body").append('<link rel="stylesheet" href="'+e+'" />'),t())},e.prototype.applyStyles=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;i=this;if(i.styles==null)return e;(p=i._pathTypes)==null&&(i._pathTypes=["path","circle","rectangle","ellipse"]),(d=i._regardStyles)==null&&(i._regardStyles=["fill","stroke","fill-opacity","stroke-width","stroke-opacity"]);for(u in i.styles){s=u,v=s.split(",");for(f=0,c=v.length;f<c;f++){a=v[f],s=a.split(" "),s=s[s.length-1],s=s.split(":");if(s.length>1)continue;s=s[0].split("."),n=s.slice(1);if(n.length>0&&n.indexOf(t)<0)continue;s=s[0];if(i._pathTypes.indexOf(s)>=0&&s!==e.type)continue;o=i.styles[u],m=i._regardStyles;for(l=0,h=m.length;l<h;l++)r=m[l],o[r]!=null&&e.attr(r,o[r])}}return e},e}(),vt.Kartograph=C,vt.map=function(e,t,n){return new C(e,t,n)},vt.__mapCache={},St=typeof exports!="undefined"&&exports!==null?exports:this,vt=(Ft=St.kartograph)!=null?Ft:St.kartograph={},D=function(){function e(e,t,n){n==null&&(n=0),this.lon=Number(e),this.lat=Number(t),this.alt=Number(n)}return e.prototype.distance=function(e){var t,n,r,i,s,o,u,a,f;return f=this,t=6371,o=Math.PI/180,i=(e.lat-f.lat)*o,s=(e.lon-f.lon)*o,u=f.lat*o,a=e.lat*o,n=Math.sin(i/2)*Math.sin(i/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(u)*Math.cos(a),r=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),t*r},e}(),A=function(e){function t(e,n,r){r==null&&(r=0),t.__super__.constructor.call(this,n,e,r)}return Vt(t,e),t}(D),vt.LonLat=D,vt.LatLon=A,H=function(){function e(e,t,n,r){var i;i=this,i.id=e,i.path_id=t,i.paper=n.paper,i.view=n.viewBC,i.map=n,i.filter=r}return e.prototype.addPath=function(e,t){var n,r,i,s,o,u,a;r=this,(o=r.paths)==null&&(r.paths=[]),n=new B(e,r.id,r.map,t);if(kt(r.filter)==="function"&&r.filter(n.data)===!1){n.remove();return}r.paths.push(n);if(r.path_id!=null)return(u=r.pathsById)==null&&(r.pathsById={}),(a=(i=r.pathsById)[s=n.data[r.path_id]])==null&&(i[s]=[]),r.pathsById[n.data[r.path_id]].push(n)},e.prototype.hasPath=function(e){var t;return t=this,t.pathsById!=null&&t.pathsById[e]!=null},e.prototype.getPathsData=function(){var e,t,n,r,i,s;e=this,n=[],s=e.paths;for(r=0,i=s.length;r<i;r++)t=s[r],n.push(t.data);return n},e.prototype.getPath=function(e){var t;t=this;if(t.hasPath(e))return t.pathsById[e][0];throw"path "+e+" not found"},e.prototype.setView=function(e){var t,n,r,i,s,o;t=this,s=t.paths,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n.setView(e));return o},e.prototype.remove=function(){var e,t,n,r,i,s;e=this,i=e.paths,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t.remove());return s},e}(),gt=0,B=function(){function e(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;u=this,a=n.paper,p=n.viewBC,u.path=f=vt.geom.Path.fromSVG(e),u.vpath=p.projectPath(f),u.svgPath=u.vpath.toSVG(a),n.styles==null?u.svgPath.node.setAttribute("class",t):n.applyStyles(u.svgPath,t),c="path_"+gt++,u.svgPath.node.setAttribute("id",c),n.pathById[c]=u,s={};for(o=v=0,m=e.attributes.length-1;0<=m?v<=m:v>=m;o=0<=m?++v:--v)i=e.attributes[o],i.name.substr(0,5)==="data-"&&(h=i.value,d=Number(h),h.trim()!==""&&d===h&&!isNaN(d)&&(h=d),s[i.name.substr(5)]=h);u.data=s,kt(r)==="string"?l=r:kt(r)==="function"&&(l=r(s)),l!=null&&u.svgPath.attr("title",l)}return e.prototype.setView=function(e){var t,n,r;t=this,n=e.projectPath(t.path),t.vpath=n;if(t.path.type==="path")return r=n.svgString(),t.svgPath.attr({path:r});if(t.path.type==="circle")return t.svgPath.attr({cx:n.x,cy:n.y,r:n.r})},e.prototype.remove=function(){var e;return e=this,e.svgPath.remove()},e}(),St=typeof exports!="undefined"&&exports!==null?exports:this,vt=(It=St.kartograph)!=null?It:St.kartograph={},vt.parsecss=function(e,t){var n,r,i,s,o,u,a,f;s={},e=yt(e),f=e.split("`b%");for(u=0,a=f.length;u<a;u++){n=f[u],n=n.split("%b`");if(n.length<2)continue;n[0]=Et(n[0]),i=wt(n[1]);if(s[n[0]]!=null)for(r in i)o=i[r],s[n[0]][r]=o;else s[n[0]]=i}if(kt(t)!=="function")return s;t(s)},bt={},wt=function(e){var t,n,r,i,s,o;r=bt[e].replace(/^{|}$/g,""),r=yt(r),n={},o=r.split(";");for(i=0,s=o.length;i<s;i++){t=o[i],t=t.split(":");if(t.length<2)continue;n[Et(t[0])]=Et(t.slice(1).join(":"))}return n},Q=/{[^{}]*}/,Y=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,G=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,Z=/%\w`(\d+)`\w%/,xt=0,yt=function(e,t){var n,r,i;e=e.replace(G,function(e,t){var n;return t?(n="%s`"+ ++xt+"`s%",bt[xt]=t.replace(/^\\/,""),n):""}),n=t?Y:Q;while(r=n.exec(e))i="%b`"+ ++xt+"`b%",bt[xt]=r[0],e=e.replace(n,i);return e},Et=function(e){var t;if(e==null)return e;while(t=Z.exec(e))e=e.replace(Z,bt[t[1]]);return e.trim()},St=typeof exports!="undefined"&&exports!==null?exports:this,vt=(qt=St.kartograph)!=null?qt:St.kartograph={},(Rt=vt.geom)==null&&(vt.geom={}),z=function(){function e(e,t,n){var r;n==null&&(n=!0),r=this,r.type=e,r.contours=t,r.closed=n}return e.prototype.clipToBBox=function(e){throw"path clipping is not implemented yet"},e.prototype.toSVG=function(e){var t;return t=this.svgString(),e.path(t)},e.prototype.svgString=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;r=this,i="",n=r.closed?"Z M":"M",c=r.contours;for(u=0,f=c.length;u<f;u++){e=c[u],t=!0,i+=i===""?"M":n;for(a=0,l=e.length;a<l;a++)h=e[a],s=h[0],o=h[1],t||(i+="L"),i+=s+","+o,t=!1}return r.closed&&(i+="Z"),i},e.prototype.area=function(){var e,t,n,r,i,s,o,u,a;r=this;if(r.areas!=null)return r._area;r.areas=[],r._area=0,u=r.contours;for(i=0,o=u.length;i<o;i++){t=u[i],e=0;for(n=s=0,a=t.length-2;0<=a?s<=a:s>=a;n=0<=a?++s:--s)e+=t[n][0]*t[n+1][1]-t[n+1][0]*t[n][1];e*=.5,e=e,r.areas.push(e),r._area+=e}return r._area},e.prototype.centroid=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;h=this;if(h._centroid!=null)return h._centroid;t=h.area(),r=i=0;for(u=b=0,T=h.contours.length-1;0<=T?b<=T:b>=T;u=0<=T?++b:--b){n=h.contours[u],e=h.areas[u],g=y=0,l=n.length,S=[],v=0;for(a=w=0,N=l-1;0<=N?w<=N:w>=N;a=0<=N?++w:--w)p=n[a],d=n[(a+1)%l],s=d[0]-p[0],o=d[1]-p[1],c=Math.sqrt(s*s+o*o),S.push(c),v+=c;for(a=E=0,x=l-1;0<=x?E<=x:E>=x;a=0<=x?++E:--E)p=n[a],d=n[(a+1)%l],m=S[a]/v,g+=m*p[0],y+=m*p[1];f=e/t,r+=g*f,i+=y*f}return h._centroid=[r,i],h._centroid},e.prototype.isInside=function(e,t){var n,r,i,s,o,u;s=this,n=s._bbox;if(e<n[0]||e>n[2]||t<n[1]||t>n[3])return!1;for(i=o=0,u=s.contours.length-1;0<=u?o<=u:o>=u;i=0<=u?++o:--o){r=s.contours[i];if(Nt(r,[e,t]))return!0}return!1},e}(),vt.geom.Path=z,l=function(e){function t(e,n,r){this.x=e,this.y=n,this.r=r,t.__super__.constructor.call(this,"circle",null,!0)}return Vt(t,e),t.prototype.toSVG=function(e){var t;return t=this,e.circle(t.x,t.y,t.r)},t.prototype.centroid=function(){var e;return e=this,[e.x,e.y]},t.prototype.area=function(){var e;return e=this,Math.PI*e.r*m.r},t}(z),vt.geom.Circle=l,z.fromSVG=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;i=[],h=e.nodeName,l=null;if(h==="path"){a=e.getAttribute("d").trim(),u=Raphael.parsePathString(a),t=u[u.length-1]==="Z",c=t?"Z M":"M",r=[];for(p=0,d=u.length;p<d;p++){n=u[p];if(n.length===0)continue;n[0]==="M"?(r.length>2&&(i.push(r),r=[]),r.push([n[1],n[2]])):n[0]==="L"?r.push([n[1],n[2]]):n[0]==="Z"&&r.length>2&&(i.push(r),r=[])}r.length>2&&(i.push(r),r=[]),l=new vt.geom.Path(h,i,t)}else h==="circle"&&(s=e.getAttribute("cx"),o=e.getAttribute("cy"),f=e.getAttribute("r"),l=new vt.geom.Circle(s,o,f));return l},O=function(){function e(e){this.points=e}return e.prototype.clipToBBox=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;c=this,n=(new vt.geom.clipping.CohenSutherland).clip,l=[],s=[],i=!1;for(r=m=0,b=c.points.length-2;0<=b?m<=b:m>=b;r=0<=b?++m:--m){w=c.points[r],o=w[0],u=w[1],g=c.points[r+1],a=g[0],f=g[1];try{y=n(t,o,u,a,f),h=y[0],d=y[1],p=y[2],v=y[3],i=!0,l.push([h,d]),(a!==p||f!==d||r===len(c.points)-2)&&l.push([p,v])}catch(E){i&&l.length>1&&(s.push(new e(l)),l=[]),i=!1}}return l.length>1&&s.push(new e(l)),s},e.prototype.toSVG=function(){var e,t,n,r,i,s,o,u;t=this,e=[],o=t.points;for(i=0,s=o.length;i<s;i++)u=o[i],n=u[0],r=u[1],e.push(n+","+r);return"M"+e.join("L")},e}(),vt.geom.Line=O,Nt=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;u=Math.PI,r=Math.atan2,l=u*2,o=e.length,n=0;for(s=v=0,m=o-1;0<=m?v<=m:v>=m;s=0<=m?++v:--v){c=e[s][0]-t[0],p=e[s][1]-t[1],h=e[(s+1)%o][0]-t[0],d=e[(s+1)%o][1]-t[1],a=r(p,c),f=r(d,h),i=f-a;while(i>u)i-=l;while(i<-u)i+=l;n+=i}return Math.abs(n)>=u},St=typeof exports!="undefined"&&exports!==null?exports:this,vt=(Ut=St.kartograph)!=null?Ut:St.kartograph={},Ct=vt.proj={},Function.prototype.bind=function(e){var t;return t=this,function(){return t.apply(e,arguments)}},X=function(){function e(e){var t,n,r;t=this,t.lon0=(r=e.lon0)!=null?r:0,t.lat0=(n=e.lat0)!=null?n:0,t.PI=Math.PI,t.HALFPI=t.PI*.5,t.QUARTERPI=t.PI*.25,t.RAD=t.PI/180,t.DEG=180/t.PI,t.lam0=t.rad(this.lon0),t.phi0=t.rad(this.lat0),t.minLat=-90,t.maxLat=90}return e.parameters=[],e.title="Projection",e.prototype.rad=function(e){return e*this.RAD},e.prototype.deg=function(e){return e*this.DEG},e.prototype.plot=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;t==null&&(t=!0),s=[],n=!0;for(f=0,l=e.length;f<l;f++)h=e[f],i=h[0],r=h[1],o=this._visible(i,r),o&&(n=!1),c=this.project(i,r),u=c[0],a=c[1],!o&&t?s.push(this._truncate(u,a)):s.push([u,a]);return n?null:[s]},e.prototype.sea=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p;s=this,i=s.project.bind(this),r=[],e=s.lon0,s.lon0=0;for(n=o=-180;o<=180;n=++o)r.push(i(n,s.maxLat));for(t=u=p=s.maxLat,l=s.minLat;p<=l?u<=l:u>=l;t=p<=l?++u:--u)r.push(i(180,t));for(n=a=180;a>=-180;n=--a)r.push(i(n,s.minLat));for(t=f=c=s.minLat,h=s.maxLat;c<=h?f<=h:f>=h;t=c<=h?++f:--f)r.push(i(-180,t));return s.lon0=e,r},e.prototype.world_bbox=function(){var e,t,n,r,i,s;t=this.project.bind(this),r=this.sea(),e=new vt.BBox;for(i=0,s=r.length;i<s;i++)n=r[i],e.update(n[0],n[1]);return e},e.prototype.toString=function(){var e;return e=this,"[Proj: "+e.name+"]"},e}(),X.fromXML=function(e){var t,n,r,i,s,o,u;r=e.getAttribute("id"),i={};for(n=o=0,u=e.attributes.length-1;0<=u?o<=u:o>=u;n=0<=u?++o:--o)t=e.attributes[n],t.name!=="id"&&(i[t.name]=t.value);return s=new vt.proj[r](i),s.name=r,s},vt.Proj=X,p=function(e){function t(e){var n,r,i;e==null&&(e={}),n=this,n.flip=Number((i=e.flip)!=null?i:0),n.flip===1&&(e.lon0=(r=-e.lon0)!=null?r:0),t.__super__.constructor.call(this,e)}return Vt(t,e),t.parameters=["lon0","flip"],t.title="Cylindrical Projection",t.prototype._visible=function(e,t){return!0},t.prototype.clon=function(e){return e-=this.lon0,e<-180?e+=360:e>180&&(e-=360),e},t.prototype.ll=function(e,t){return this.flip===1?[-e,-t]:[e,t]},t}(X),g=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.title="Equirectangular Projection",t.prototype.project=function(e,t){var n;return n=this.ll(e,t),e=n[0],t=n[1],e=this.clon(e),[e*Math.cos(this.phi0)*1e3,t*-1*1e3]},t}(p),Ct.lonlat=g,a=function(e){function t(e){var n;t.__super__.constructor.call(this,e),this.lat1=(n=e.lat1)!=null?n:0,this.phi1=this.rad(this.lat1)}return Vt(t,e),t.parameters=["lon0","lat1","flip"],t.title="Cylindrical Equal Area",t.prototype.project=function(e,t){var n,r,i,s,o;return o=this.ll(e,t),e=o[0],t=o[1],n=this.rad(this.clon(e)),r=this.rad(t*-1),i=n*Math.cos(this.phi1),s=Math.sin(r)/Math.cos(this.phi1),[i*1e3,s*1e3]},t}(p),Ct.cea=a,b=function(e){function t(e){e.lat1=45,t.__super__.constructor.call(this,e)}return Vt(t,e),t.title="Gall-Peters Projection",t.parameters=["lon0","flip"],t}(a),Ct.gallpeters=b,x=function(e){function t(e){e.lat1=37.7,t.__super__.constructor.call(this,e)}return Vt(t,e),t.title="Hobo-Dyer Projection",t.parameters=["lon0","flip"],t}(a),Ct.hobodyer=x,i=function(e){function t(e){e.lat1=30,t.__super__.constructor.call(this,e)}return Vt(t,e),t.title="Behrmann Projection",t.parameters=["lon0","flip"],t}(a),Ct.behrmann=i,r=function(e){function t(e){e.lat1=50,t.__super__.constructor.call(this,e)}return Vt(t,e),t.title="Balthasart Projection",t.parameters=["lon0","flip"],t}(a),Ct.balthasart=r,j=function(e){function t(e){t.__super__.constructor.call(this,e),this.minLat=-85,this.maxLat=85}return Vt(t,e),t.title="Mercator Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a;return s=this,a=s.ll(e,t),e=a[0],t=a[1],r=Math,n=s.rad(s.clon(e)),i=s.rad(t*-1),o=n*1e3,u=r.log((1+r.sin(i))/r.cos(i))*1e3,[o,u]},t}(p),Ct.mercator=j,J=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.title="Pseudo-Cylindrical Projection",t}(p),I=function(e){function t(e){var n;t.__super__.constructor.call(this,e),n=this,n.A0=.8707,n.A1=-0.131979,n.A2=-0.013791,n.A3=.003971,n.A4=-0.001529,n.B0=1.007226,n.B1=.015085,n.B2=-0.044475,n.B3=.028874,n.B4=-0.005916,n.C0=n.B0,n.C1=3*n.B1,n.C2=7*n.B2,n.C3=9*n.B3,n.C4=11*n.B4,n.EPS=1e-11,n.MAX_Y=.8707*.52*Math.PI;return}return Vt(t,e),t.title="Natural Earth Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f;return o=this,f=o.ll(e,t),e=f[0],t=f[1],n=o.rad(o.clon(e)),r=o.rad(t*-1),i=r*r,s=i*i,u=n*(o.A0+i*(o.A1+i*(o.A2+s*i*(o.A3+i*o.A4))))*180+500,a=r*(o.B0+i*(o.B1+s*(o.B2+o.B3*i+o.B4*s)))*180+270,[u,a]},t}(J),Ct.naturalearth=I,et=function(e){function t(e){var n;t.__super__.constructor.call(this,e),n=this,n.X=[1,-5.67239e-12,-0.0000715511,311028e-11,.9986,-0.000482241,-0.000024897,-0.00000133094,.9954,-0.000831031,-0.000044861,-9.86588e-7,.99,-0.00135363,-0.0000596598,367749e-11,.9822,-0.00167442,-0.0000044975,-0.00000572394,.973,-0.00214869,-0.0000903565,1.88767e-8,.96,-0.00305084,-0.0000900732,164869e-11,.9427,-0.00382792,-0.0000653428,-0.00000261493,.9216,-0.00467747,-0.000104566,48122e-10,.8962,-0.00536222,-0.0000323834,-0.00000543445,.8679,-0.00609364,-0.0001139,332521e-11,.835,-0.00698325,-0.0000640219,9.34582e-7,.7986,-0.00755337,-0.0000500038,9.35532e-7,.7597,-0.00798325,-0.0000359716,-0.00000227604,.7186,-0.00851366,-0.000070112,-0.00000863072,.6732,-0.00986209,-0.000199572,191978e-10,.6213,-0.010418,883948e-10,624031e-11,.5722,-0.00906601,181999e-9,624033e-11,.5322,0,0,0],n.Y=[0,.0124,3.72529e-10,1.15484e-9,.062,.0124001,1.76951e-8,-5.92321e-9,.124,.0123998,-7.09668e-8,2.25753e-8,.186,.0124008,2.66917e-7,-8.44523e-8,.248,.0123971,-9.99682e-7,3.15569e-7,.31,.0124108,373349e-11,-0.0000011779,.372,.0123598,-0.000013935,439588e-11,.434,.0125501,520034e-10,-0.0000100051,.4968,.0123198,-0.0000980735,922397e-11,.5571,.0120308,402857e-10,-0.0000052901,.6176,.0120369,-0.0000390662,7.36117e-7,.6769,.0117015,-0.0000280246,-8.54283e-7,.7346,.0113572,-0.0000408389,-5.18524e-7,.7903,.0109099,-0.0000486169,-0.0000010718,.8435,.0103433,-0.0000646934,5.36384e-9,.8936,.00969679,-0.0000646129,-0.00000854894,.9394,.00840949,-0.000192847,-0.00000421023,.9761,.00616525,-0.000256001,-0.00000421021,1,0,0,0],n.NODES=18,n.FXC=.8487,n.FYC=1.3523,n.C1=11.459155902616464,n.RC1=.08726646259971647,n.ONEEPS=1.000001,n.EPS=1e-8;return}return Vt(t,e),t.title="Robinson Projection",t.prototype._poly=function(e,t,n){return e[t]+n*(e[t+1]+n*(e[t+2]+n*e[t+3]))},t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f;return o=this,f=o.ll(e,t),e=f[0],t=f[1],e=o.clon(e),r=o.rad(e),i=o.rad(t*-1),s=Math.abs(i),n=Math.floor(s*o.C1),n>=o.NODES&&(n=o.NODES-1),s=o.deg(s-o.RC1*n),n*=4,u=o._poly(o.X,n,s)*o.FXC*r,a=o._poly(o.Y,n,s)*o.FYC,i<0&&(a=-a),[u,a]},t}(J),Ct.robinson=et,d=function(e){function t(e){var n;t.__super__.constructor.call(this,e),n=this,n.C_x=.4222382003157712,n.C_y=1.3265004281770023,n.RC_y=.7538633073600218,n.C_p=3.5707963267948966,n.RC_p=.2800495767557787,n.EPS=1e-7,n.NITER=6}return Vt(t,e),t.title="Eckert IV Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;u=this,h=u.ll(e,t),e=h[0],t=h[1],s=u.rad(u.clon(e)),o=u.rad(t*-1),a=u.C_p*Math.sin(o),n=o*o,o*=.895168+n*(.0218849+n*.00826809),i=u.NITER;while(i>0){r=Math.cos(o),f=Math.sin(o),n=(o+f*(r+2)-a)/(1+r*(r+2)-f*f),o-=n;if(Math.abs(n)<u.EPS)break;i-=1}return i===0?(l=u.C_x*s,c=o<0?-u.C_y:u.C_y):(l=u.C_x*s*(1+Math.cos(o)),c=u.C_y*Math.sin(o)),[l,c]},t}(J),Ct.eckert4=d,rt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.title="Sinusoidal Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u;return r=this,u=r.ll(e,t),e=u[0],t=u[1],n=r.rad(r.clon(e)),i=r.rad(t*-1),s=1032*n*Math.cos(i),o=1032*i,[s,o]},t}(J),Ct.sinusoidal=rt,F=function(e){function t(e,n,r,i,s){var o,u,a,f;n==null&&(n=1.5707963267948966),r==null&&(r=null),i==null&&(i=null),s==null&&(s=null),t.__super__.constructor.call(this,e),o=this,o.MAX_ITER=10,o.TOLERANCE=1e-7,n!=null?(u=n+n,f=Math.sin(n),a=Math.sqrt(Math.PI*2*f/(u+Math.sin(u))),o.cx=2*a/Math.PI,o.cy=a/f,o.cp=u+Math.sin(u)):r!=null&&i!=null&&typeof cz!="undefined"&&cz!==null?(o.cx=r,o.cy=i,o.cp=s):Tt("kartograph.proj.Mollweide: either p or cx,cy,cp must be defined")}return Vt(t,e),t.title="Mollweide Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;u=this,h=u.ll(e,t),e=h[0],t=h[1],o=Math,n=o.abs,s=u.rad(u.clon(e)),a=u.rad(t),i=u.cp*o.sin(a),r=u.MAX_ITER;while(r!==0){f=(a+o.sin(a)-i)/(1+o.cos(a)),a-=f;if(n(f)<u.TOLERANCE)break;r-=1}return r===0?a=a>=0?u.HALFPI:-u.HALFPI:a*=.5,l=1e3*u.cx*s*o.cos(a),c=1e3*u.cy*o.sin(a),[l,c*-1]},t}(J),Ct.mollweide=F,lt=function(e){function t(e){t.__super__.constructor.call(this,e,1.0471975511965976)}return Vt(t,e),t.title="Wagner IV Projection",t}(F),Ct.wagner4=lt,ct=function(e){function t(e){t.__super__.constructor.call(this,e,null,.90977,1.65014,3.00896)}return Vt(t,e),t.title="Wagner V Projection",t}(F),Ct.wagner5=ct,P=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var t,n;return Vt(r,e),n=-89,t=89,r.parameters=["lon0","lat0","flip"],r.title="Loximuthal Projection (equidistant)",r.prototype.project=function(e,t){var n,r,i,s,o,u,a;return i=this,a=i.ll(e,t),e=a[0],t=a[1],r=Math,n=i.rad(i.clon(e)),s=i.rad(t),s===i.phi0?o=n*r.cos(i.phi0):o=n*(s-i.phi0)/(r.log(r.tan(i.QUARTERPI+s*.5))-r.log(r.tan(i.QUARTERPI+i.phi0*.5))),o*=1e3,u=1e3*(s-i.phi0),[o,u*-1]},r}(J),Ct.loximuthal=P,f=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}var t,n,r,i,s;return Vt(o,e),o.title="Canters Modified Sinusoidal I",o.parameters=["lon0"],t=1.1966,n=-0.129,r=3*n,i=-0.0076,s=5*i,o.prototype.project=function(e,o){var u,a,f,l,c,h;return u=this,h=u.ll(e,o),e=h[0],o=h[1],e=u.rad(u.clon(e)),o=u.rad(o),l=o*o,c=l*l,a=1e3*e*Math.cos(o)/(t+r*l+s*c),f=1e3*o*(t+n*l+i*c),[a,f*-1]},o}(J),Ct.canters1=f,S=function(e){function d(e){d.__super__.constructor.call(this,e)}var t,n,r,i,s,o,u,a,f,l,c,h,p;return Vt(d,e),d.title="Hatano Projection",u=20,r=1e-7,a=1.000001,t=2.67595,n=2.43763,f=.3736990601468637,l=.4102345310814193,s=1.75859,o=1.93052,h=.5686373742600607,p=.5179951515653813,i=.85,c=1.1764705882352942,d.prototype.project=function(e,a){var f,l,c,h,p,d,v,m,g,y;h=this,y=h.ll(e,a),e=y[0],a=y[1],c=h.rad(h.clon(e)),p=h.rad(a),f=Math.sin(p)*(p<0?n:t);for(l=g=u;g>=1;l=g+=-1){d=(p+Math.sin(p)-f)/(1+Math.cos(p)),p-=d;if(Math.abs(d)<r)break}return v=1e3*i*c*Math.cos(p*=.5),m=1e3*Math.sin(p)*(p<0?o:s),[v,m*-1]},d}(J),Ct.hatano=S,E=function(e){function t(e){var n;t.__super__.constructor.call(this,e),n=this,n.lat1=41.737,n.p1=new F,n.p0=new rt}return Vt(t,e),t.title="Goode Homolosine Projection",t.parameters=["lon0"],t.prototype.project=function(e,t){var n,r;return n=this,r=n.ll(e,t),e=r[0],t=r[1],e=n.clon(e),Math.abs(t)>n.lat1?n.p1.project(e,t):n.p0.project(e,t)},t}(J),Ct.goodehomolosine=E,q=function(e){function n(e){n.__super__.constructor.call(this,e),this.r=this.HALFPI*100}var t;return Vt(n,e),n.title="Nicolosi Globular Projection",n.parameters=["lon0"],t=1e-10,n.prototype._visible=function(e,t){var n;return n=this,e=n.clon(e),e>-90&&e<90},n.prototype.project=function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;return u=this,v=u.ll(e,n),e=v[0],n=v[1],s=u.rad(u.clon(e)),f=u.rad(n),Math.abs(s)<t?(p=0,d=f):Math.abs(f)<t?(p=s,d=0):Math.abs(Math.abs(s)-u.HALFPI)<t?(p=s*Math.cos(f),d=u.HALFPI*Math.sin(f)):Math.abs(Math.abs(f)-u.HALFPI)<t?(p=0,d=f):(h=u.HALFPI/s-s/u.HALFPI,r=f/u.HALFPI,c=Math.sin(f),i=(1-r*r)/(c-r),l=h/i,l*=l,o=(h*c/i-.5*h)/(1+l),a=(c/l+.5*i)/(1+1/l),p=Math.cos(f),p=Math.sqrt(o*o+p*p/(1+l)),p=u.HALFPI*(o+(s<0?-p:p)),d=Math.sqrt(a*a-(c*c/l+i*c-1)/(1+1/l)),d=u.HALFPI*(a+(f<0?d:-d))),[p*100,d*-100]},n.prototype.sea=function(){var e,t,n,r,i;t=[],r=this.r,e=Math;for(n=i=0;i<=360;n=++i)t.push([e.cos(this.rad(n))*r,e.sin(this.rad(n))*r]);return t},n.prototype.world_bbox=function(){var e;return e=this.r,new vt.BBox(-e,-e,e*2,e*2)},n}(J),Ct.nicolosi=q,t=function(e){function t(e,n){var r;n==null&&(n=1e3),t.__super__.constructor.call(this,e),r=this,r.r=n,r.elevation0=r.to_elevation(r.lat0),r.azimuth0=r.to_azimuth(r.lon0)}return Vt(t,e),t.parameters=["lon0","lat0"],t.title="Azimuthal Projection",t.prototype.to_elevation=function(e){var t;return t=this,(e+90)/180*t.PI-t.HALFPI},t.prototype.to_azimuth=function(e){var t;return t=this,(e+180)/360*t.PI*2-t.PI},t.prototype._visible=function(e,t){var n,r,i,s,o;return o=this,s=Math,i=o.to_elevation(t),n=o.to_azimuth(e),r=s.sin(i)*s.sin(o.elevation0)+s.cos(o.elevation0)*s.cos(i)*s.cos(n-o.azimuth0),r>=0},t.prototype._truncate=function(e,t){var n,r,i,s,o;return n=Math,r=this.r,i=n.atan2(t-r,e-r),s=r+r*n.cos(i),o=r+r*n.sin(i),[s,o]},t.prototype.sea=function(){var e,t,n,r,i;t=[],r=this.r,e=Math;for(n=i=0;i<=360;n=++i)t.push([r+e.cos(this.rad(n))*r,r+e.sin(this.rad(n))*r]);return t},t.prototype.world_bbox=function(){var e;return e=this.r,new vt.BBox(0,0,e*2,e*2)},t}(X),R=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.title="Orthographic Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f;return s=this,i=Math,r=s.to_elevation(t),n=s.to_azimuth(e),u=s.r*i.cos(r)*i.sin(n-s.azimuth0),f=-s.r*(i.cos(s.elevation0)*i.sin(r)-i.sin(s.elevation0)*i.cos(r)*i.cos(n-s.azimuth0)),o=s.r+u,a=s.r+f,[o,a]},t}(t),Ct.ortho=R,k=function(e){function t(e){t.__super__.constructor.call(this,e),this.scale=Math.sqrt(2)*.5}return Vt(t,e),t.title="Lambert Azimuthal Equal-Area Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f,l,c;return o=this.rad(t),i=this.rad(e),s=Math,u=s.sin,n=s.cos,r=s.pow(2/(1+u(this.phi0)*u(o)+n(this.phi0)*n(o)*n(i-this.lam0)),.5),r*=this.scale,f=this.r*r*n(o)*u(i-this.lam0),c=-this.r*r*(n(this.phi0)*u(o)-u(this.phi0)*n(o)*n(i-this.lam0)),a=this.r+f,l=this.r+c,[a,l
]},t}(t),Ct.laea=k,st=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.title="Stereographic Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;return u=this.rad(t),s=this.rad(e),o=Math,a=o.sin,n=o.cos,i=.5,r=2*i/(1+a(this.phi0)*a(u)+n(this.phi0)*n(u)*n(s-this.lam0)),l=this.r*r*n(u)*a(s-this.lam0),h=-this.r*r*(n(this.phi0)*a(u)-a(this.phi0)*n(u)*n(s-this.lam0)),f=this.r+l,c=this.r+h,[f,c]},t}(t),Ct.stereo=st,tt=function(e){function t(e){var n,r,i,s,o,u,a,f,l,c;t.__super__.constructor.call(this,{lon0:0,lat0:0}),this.dist=(c=e.dist)!=null?c:3,this.up=this.rad((f=e.up)!=null?f:0),this.tilt=this.rad((l=e.tilt)!=null?l:0),this.scale=1,s=Number.MAX_VALUE,i=Number.MAX_VALUE*-1;for(n=u=0;u<=179;n=++u)for(r=a=0;a<=360;r=++a)o=this.project(r-180,n-90),s=Math.min(o[0],s),i=Math.max(o[0],i);this.scale=this.r*2/(i-s),t.__super__.constructor.call(this,e);return}return Vt(t,e),t.parameters=["lon0","lat0","tilt","dist","up"],t.title="Satellite Projection",t.prototype.project=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;return n==null&&(n=0),h=this.rad(t),l=this.rad(e),c=Math,v=c.sin,s=c.cos,p=this.r,d=p*(n+6371)/3671,o=v(this.phi0)*v(h)+s(this.phi0)*s(h)*s(l-this.lam0),f=(this.dist-1)/(this.dist-o),f=(this.dist-1)/(this.dist-o),f*=this.scale,b=d*f*s(h)*v(l-this.lam0),S=-d*f*(s(this.phi0)*v(h)-v(this.phi0)*s(h)*s(l-this.lam0)),a=s(this.up),g=v(this.up),u=s(this.tilt),m=v(this.tilt),i=d*(this.dist-1),r=(S*a+b*g)*v(this.tilt/i)+u,w=(b*a-S*g)*s(this.tilt/r),x=(S*a+b*g)/r,y=p+w,E=p+x,[y,E]},t.prototype._visible=function(e,t){var n,r,i,s;return i=this.to_elevation(t),n=this.to_azimuth(e),s=Math,r=s.sin(i)*s.sin(this.elevation0)+s.cos(this.elevation0)*s.cos(i)*s.cos(n-this.azimuth0),r>=1/this.dist},t.prototype.sea=function(){var e,t,n,r,i;t=[],r=this.r,e=Math;for(n=i=0;i<=360;n=++i)t.push([r+e.cos(this.rad(n))*r,r+e.sin(this.rad(n))*r]);return t},t}(t),Ct.satellite=tt,v=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.title="Equidistant Azimuthal Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d;return a=this,f=a.rad(t),o=a.rad(e),u=Math,l=u.sin,r=u.cos,i=l(this.phi0)*l(f)+r(this.phi0)*r(f)*r(o-this.lam0),n=u.acos(i),s=.325*n/l(n),h=this.r*s*r(f)*l(o-this.lam0),d=-this.r*s*(r(this.phi0)*l(f)-l(this.phi0)*r(f)*r(o-this.lam0)),c=this.r+h,p=this.r+d,[c,p]},t.prototype._visible=function(e,t){return!0},t}(t),Ct.equi=v,e=function(e){function n(e){var t;t=this,e.lat0=0,n.__super__.constructor.call(this,e),t.lam0=0}var t;return Vt(n,e),n.title="Aitoff Projection",n.parameters=["lon0"],t=.6366197723675814,n.prototype.project=function(e,n){var r,i,s,o,u,a,f,l;return o=this,l=o.ll(e,n),e=l[0],n=l[1],e=o.clon(e),s=o.rad(e),u=o.rad(n),r=.5*s,i=Math.acos(Math.cos(u)*Math.cos(r)),i!==0?(f=1/Math.sin(i),a=2*i*Math.cos(u)*Math.sin(r)*f,f*=i*Math.sin(u)):a=f=0,o.winkel&&(a=(a+s*t)*.5,f=(f+u)*.5),[a*1e3,f*-1e3]},n.prototype._visible=function(e,t){return!0},n}(J),Ct.aitoff=e,ht=function(e){function t(e){t.__super__.constructor.call(this,e),this.winkel=!0}return Vt(t,e),t.title="Winkel Tripel Projection",t}(e),Ct.winkel3=ht,h=function(e){function t(e){var n,r,i;n=this,t.__super__.constructor.call(this,e),n.lat1=(i=e.lat1)!=null?i:30,n.phi1=n.rad(n.lat1),n.lat2=(r=e.lat2)!=null?r:50,n.phi2=n.rad(n.lat2)}return Vt(t,e),t.title="Conic Projection",t.parameters=["lon0","lat0","lat1","lat2"],t.prototype._visible=function(e,t){var n;return n=this,t>n.minLat&&t<n.maxLat},t.prototype._truncate=function(e,t){return[e,t]},t.prototype.clon=function(e){return e-=this.lon0,e<-180?e+=360:e>180&&(e-=360),e},t}(X),L=function(e){function t(e){var n,r,i,s,o,u,a,f,l,c,h,p,d;l=this,t.__super__.constructor.call(this,e),o=Math,d=[o.sin,o.cos,o.abs,o.log,o.tan,o.pow],c=d[0],i=d[1],n=d[2],mt=d[3],p=d[4],a=d[5],l.n=u=h=c(l.phi1),s=i(l.phi1),f=n(l.phi1-l.phi2)>=1e-10,f&&(u=mt(s/i(l.phi2))/mt(p(l.QUARTERPI+.5*l.phi2)/p(l.QUARTERPI+.5*l.phi1))),l.c=r=s*a(p(l.QUARTERPI+.5*l.phi1),u)/u,n(n(l.phi0)-l.HALFPI)<1e-10?l.rho0=0:l.rho0=r*a(p(l.QUARTERPI+.5*l.phi0),-u),l.minLat=-60,l.maxLat=85}return Vt(t,e),t.title="Lambert Conformal Conic Projection",t.prototype.project=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;return c=this,a=c.rad(t),i=c.rad(c.clon(e)),o=Math,m=[o.sin,o.cos,o.abs,o.log,o.tan,o.pow],h=m[0],r=m[1],n=m[2],mt=m[3],p=m[4],f=m[5],u=c.n,n(n(a)-c.HALFPI)<1e-10?l=0:l=c.c*f(p(c.QUARTERPI+.5*a),-u),s=i*u,d=1e3*l*h(s),v=1e3*(c.rho0-l*r(s)),[d,v*-1]},t}(h),Ct.lcc=L,V=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t}(h),ft=function(){function e(e,t,n,r,i,s){var o;o=this,o.bbox=e,o.width=t,o.padding=r!=null?r:0,o.halign=i!=null?i:"center",o.valign=s!=null?s:"center",o.height=n,o.scale=Math.min((t-r*2)/e.width,(n-r*2)/e.height)}return e.prototype.project=function(e,t){var n,r,i,s,o,u,a;return t==null&&(t=e[1],e=e[0]),i=this,s=i.scale,n=i.bbox,r=i.height,o=i.width,u=i.halign==="center"?(o-n.width*s)*.5:i.halign==="left"?i.padding*s:o-(n.width-i.padding)*s,a=i.valign==="center"?(r-n.height*s)*.5:i.valign==="top"?i.padding*s:0,e=(e-n.left)*s+u,t=(t-n.top)*s+a,[e,t]},e.prototype.projectPath=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;i=this;if(e.type==="path"){r=[],t=[99999,99999,-99999,-99999],g=e.contours;for(l=0,h=g.length;l<h;l++){o=g[l],n=[];for(c=0,p=o.length;c<p;c++)d=o[c],a=d[0],f=d[1],v=i.project(a,f),a=v[0],f=v[1],n.push([a,f]),t[0]=Math.min(t[0],a),t[1]=Math.min(t[1],f),t[2]=Math.max(t[2],a),t[3]=Math.max(t[3],f);r.push(n)}return s=new vt.geom.Path(e.type,r,e.closed),s._bbox=t,s}if(e.type==="circle")return m=i.project(e.x,e.y),a=m[0],f=m[1],u=e.r*i.scale,new vt.geom.Circle(a,f,u)},e.prototype.asBBox=function(){var e;return e=this,new vt.BBox(0,0,e.width,e.height)},e}(),ft.fromXML=function(e){var t,r,i,s,o;return o=Number(e.getAttribute("w")),i=Number(e.getAttribute("h")),s=Number(e.getAttribute("padding")),r=e.getElementsByTagName("bbox")[0],t=n.fromXML(r),new vt.View(t,o,i,s)},St=typeof exports!="undefined"&&exports!==null?exports:this,(zt=St.kartograph)==null&&(St.kartograph={}),St.kartograph.View=ft,St=typeof exports!="undefined"&&exports!==null?exports:this,vt=St.$K=(Dt=St.kartograph)!=null?Dt:St.kartograph={},vt.Kartograph.prototype.choropleth=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;l=this,f=(E=e.layer)!=null?E:l.layerIds[l.layerIds.length-1];if(!l.layers.hasOwnProperty(f)){Tt('choropleth error: layer "'+f+'" not found');return}i=e.data,s=e.key,r=e.colors,p={};if(s!=null&&kt(i)==="array")for(g=0,b=i.length;g<b;g++)m=i[g],a=m[s],p[String(a)]=m;else if(kt(i)==="object")for(a in i)m=i[a],p[String(a)]=m;S=l.layers[f].pathsById;for(a in S){d=S[a];for(y=0,w=d.length;y<w;y++)h=d[y],i==null&&(v=h.data),kt(i)==="function"?v=i(h.data):v=(x=p[a])!=null?x:null,n=r(v,h.data),e.duration!=null&&e.duration>0?(kt(e.duration)==="function"?u=e.duration(v):u=e.duration,e.delay!=null?kt(e.delay)==="function"?o=e.delay(v):o=e.delay:o=0,h.svgPath.attrs.fill==="none"&&(c=r(null,h.data),h.svgPath.attr("fill",c)),t=Raphael.animation({fill:n},u),h.svgPath.animate(t.delay(o))):h.svgPath.attr("fill",n)}},vt.Kartograph.prototype.dotgrid=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K;g=this,m=(j=e.layer)!=null?j:g.layerIds[g.layerIds.length-1];if(!g.layers.hasOwnProperty(m)){Tt('dotgrid error: layer "'+m+'" not found');return}v=g.layers[m],n=e.data,r=e.value,i=e.key,b={};if(i!=null&&kt(n)==="array")for(k=0,M=n.length;k<M;k++)S=n[k],d=S[i],b[String(d)]=S;else for(d in n)S=n[d],b[String(d)]=S;a=(F=e.style)!=null?F:{fill:"black",stroke:"none"},T=e.size,p=(I=e.gridsize)!=null?I:15,u=(q=v.dotgrid)!=null?q:v.dotgrid={gridsize:p,grid:[]};if(u.gridsize!==p){R=u.grid;for(L=0,_=R.length;L<_;L++)h=R[L],h.shape!=null&&(h.shape.remove(),h.shape=null)}if(p>0){if(u.grid.length===0)for(N=A=0,U=g.viewport.width;0<=U?A<=U:A>=U;N=A+=p)for(C=O=0,z=g.viewport.height;0<=z?O<=z:O>=z;C=O+=p){h={x:N+(Math.random()-.5)*p*.2,y:C+(Math.random()-.5)*p*.2,pathid:!1},c=!1,W=v.pathsById;for(d in W){w=W[d];for(H=0,D=w.length;H<D;H++){y=w[H];if(y.vpath.isInside(h.x,h.y)){c=!0,E=(X=b[d])!=null?X:null,x=T(E),h.pathid=d,h.shape=v.paper.circle(h.x,h.y,1);break}}if(c)break}u.grid.push(h)}V=u.grid;for(B=0,P=V.length;B<P;B++)h=V[B],h.pathid&&(E=($=b[h.pathid])!=null?$:null,x=T(E),l=(J=e.duration)!=null?J:0,s=(K=e.delay)!=null?K:0,kt(s)==="function"?o=s(E):o=s,l>0&&Raphael.svg?(t=Raphael.animation({r:x*.5},l),h.shape.animate(t.delay(o))):h.shape.attr({r:x*.5}),kt(a)==="function"?f=a(E):f=a,h.shape.attr(f))}},dt=(Pt=vt.filter)!=null?Pt:vt.filter={},dt.__knownFilter={},dt.__patternFills=0,H.prototype.SVG=function(e,t){var n,r;typeof e=="string"&&(e=window.document.createElementNS("http://www.w3.org/2000/svg",e));if(t)for(n in t)r=t[n],e.setAttribute(n,r);return e},vt.Kartograph.prototype.addFilter=function(e,t,n){var r,i,s;n==null&&(n={}),s=this,r=window.document;if(vt.filter[t]==null)throw"unknown filter type "+t;return i=(new vt.filter[t](n)).getFilter(e),s.paper.defs.appendChild(i)},H.prototype.applyFilter=function(e){var t;return t=this,$("."+t.id,t.paper.canvas).attr({filter:"url(#"+e+")"})},H.prototype.applyTexture=function(e,t,n,r){var i,s,o,u,a,f;r==null&&(r="#fff"),s=this,dt.__patternFills+=1,a=s.paths,f=[];for(o=0,u=a.length;o<u;o++)i=a[o],f.push(i.svgPath.attr({fill:"url("+e+")"}));return f},y=function(){function e(e){this.params=e!=null?e:{}}return e.prototype.getFilter=function(e){var t,n;return n=this,t=n.SVG("filter",{id:e}),n.buildFilter(t),t},e.prototype._getFilter=function(){throw"not implemented"},e.prototype.SVG=function(e,t){var n,r;typeof e=="string"&&(e=window.document.createElementNS("http://www.w3.org/2000/svg",e));if(t)for(n in t)r=t[n],e.setAttribute(n,r);return e},e}(),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.prototype.buildFilter=function(e){var t,n,r;return r=this,t=r.SVG,n=t("feGaussianBlur",{stdDeviation:r.params.size||4,result:"blur"}),e.appendChild(n)},t}(y),dt.blur=o,w=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.prototype.buildFilter=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;o=this,n=(f=o.params.blur)!=null?f:4,a=(l=o.params.strength)!=null?l:1,r=(c=o.params.color)!=null?c:"#D1BEB0",typeof r=="string"&&(r=chroma.hex(r)),u=r.rgb,i=(h=o.params.inner)!=null?h:!1,s=(p=o.params.knockout)!=null?p:!1,t=(d=o.params.alpha)!=null?d:1,i?o.innerGlow(e,n,a,u,t,s):o.outerGlow(e,n,a,u,t,s)},t.prototype.outerGlow=function(e,t,n,r,i,s){var o,u,a,f,l,c,h;return l=this,o=l.SVG,f=o("feColorMatrix",{"in":"SourceGraphic",type:"matrix",values:"0 0 0 0 0   0 0 0 0 0   0 0 0 0 0   0 0 0 1 0",result:"mask"}),e.appendChild(f),n>0&&(h=o("feMorphology",{"in":"mask",radius:n,operator:"dilate",result:"mask"}),e.appendChild(h)),f=o("feColorMatrix",{"in":"mask",type:"matrix",values:"0 0 0 0 "+r[0]/255+" 0 0 0 0 "+r[1]/255+" 0 0 0 0 "+r[2]/255+"  0 0 0 1 0",result:"r0"}),e.appendChild(f),u=o("feGaussianBlur",{"in":"r0",stdDeviation:t,result:"r1"}),e.appendChild(u),a=o("feComposite",{operator:"out","in":"r1",in2:"mask",result:"comp"}),e.appendChild(a),c=o("feMerge"),s||c.appendChild(o("feMergeNode",{"in":"SourceGraphic"})),c.appendChild(o("feMergeNode",{"in":"r1"})),e.appendChild(c)},t.prototype.innerGlow=function(e,t,n,r,i,s){var o,u,a,f,l,c,h;return l=this,o=l.SVG,mt("innerglow"),f=o("feColorMatrix",{"in":"SourceGraphic",type:"matrix",values:"0 0 0 0 0   0 0 0 0 0   0 0 0 0 0   0 0 0 500 0",result:"mask"}),e.appendChild(f),h=o("feMorphology",{"in":"mask",radius:n,operator:"erode",result:"r1"}),e.appendChild(h),u=o("feGaussianBlur",{"in":"r1",stdDeviation:t,result:"r2"}),e.appendChild(u),f=o("feColorMatrix",{type:"matrix","in":"r2",values:"1 0 0 0 "+r[0]/255+" 0 1 0 0 "+r[1]/255+" 0 0 1 0 "+r[2]/255+" 0 0 0 -1 1",result:"r3"}),e.appendChild(f),a=o("feComposite",{operator:"in","in":"r3",in2:"mask",result:"comp"}),e.appendChild(a),c=o("feMerge"),s||c.appendChild(o("feMergeNode",{"in":"SourceGraphic"})),c.appendChild(o("feMergeNode",{"in":"comp"})),e.appendChild(c)},t}(y),dt.glow=w,St=typeof exports!="undefined"&&exports!==null?exports:this,vt=St.$K=(Ht=St.kartograph)!=null?Ht:St.kartograph={},vt.Kartograph.prototype.addGeoPath=function(e,t,n){var r,i,s;return t==null&&(t=[]),n==null&&(n=""),r=this,s=r.getGeoPathStr(e,t),i=r.paper.path(s),n!==""&&i.node.setAttribute("class",n),i},vt.Kartograph.prototype.getGeoPathStr=function(e,t){var n,r,i,s,o,u,a;t==null&&(t=[]),i=this,type(t)==="string"&&(t=t.split("")),t.length===0&&t.push("M"),s="";for(r in e){o=e[r],n=(a=t[r])!=null?a:"L",u=i.lonlat2xy(o);if(isNaN(u[0])||isNaN(u[1]))continue;s+=n+u[0]+","+u[1]}return s},U=function(){function e(e){this.zoomOut=Wt(this.zoomOut,this),this.zoomIn=Wt(this.zoomIn,this);var t,n,r,i,s,o,u,a;i=this,i.map=e,t=e.container,n=function(e,t){var n,r,i,s;t==null&&(t=[]),r=$('<div class="'+e+'" />');for(i=0,s=t.length;i<s;i++)n=t[i],r.append(n);return r},r=function(e){return $(e.target).addClass("md")},s=function(e){return $(e.target).removeClass("md")},a=n("plus"),a.mousedown(r),a.mouseup(s),a.click(i.zoomIn),u=n("minus"),u.mousedown(r),u.mouseup(s),u.click(i.zoomOut),o=n("zoom-control",[a,u]),t.append(o)}return e.prototype.zoomIn=function(e){var t;return t=this,t.map.opts.zoom+=1,t.map.resize()},e.prototype.zoomOut=function(e){var t;return t=this,t.map.opts.zoom-=1,t.map.opts.zoom<1&&(t.map.opts.zoom=1),t.map.resize()},e}(),nt=function(){function e(e,t,n){var r,i,s,o;e==null&&(e=[0,1]),t==null&&(t=null),n==null&&(n=null),this.scale=Wt(this.scale,this),i=this,o=[];for(r in e){if(kt(n)==="function"&&n(e[r])===!1)continue;t!=null?kt(t)==="function"?s=t(e[r]):s=e[r][t]:s=e[r],isNaN(s)||o.push(s)}o=o.sort(function(e,t){return e-t}),i.values=o}return e.prototype.scale=function(e){return e},e}(),M=function(e){function t(){return this.scale=Wt(this.scale,this),t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.prototype.scale=function(e){var t,n;return t=this,n=t.values,(e-n[0])/(n[n.length-1]-n[0])},t}(nt),_=function(e){function t(){return this.scale=Wt(this.scale,this),t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.prototype.scale=function(e){var t,n;return t=this,n=t.values,mt=Math.log,(mt(e)-mt(n[0]))/(mt(n[n.length-1])-mt(n[0]))},t}(nt),K=function(e){function t(){return this.scale=Wt(this.scale,this),t.__super__.constructor.apply(this,arguments)}return Vt(t,e),t.prototype.scale=function(e){var t,n,r,i,s,o;r=this,o=r.values,n=o.length-1;for(t in o){s=o[Number(t)],i=o[Number(t)+1];if(e===s)return t/n;if(t<n&&e>s&&e<i)return t/n+(e-s)/(i-s)}},t}(nt),vt.scale={},vt.scale.identity=function(e){return(new nt(domain,prop,dt)).scale},vt.scale.linear=function(e,t,n){return(new M(e,t,n)).scale},vt.scale.log=function(e,t,n){return(new _(e,t,n)).scale},vt.scale.quantile=function(e,t,n){return(new K(e,t,n)).scale},ut=function(){function t(t){e=this,e.location=t.location,e.data=t.data,e.map=t.map,e.layers=t.layers,e.x=t.x,e.y=t.y}var e;return e=null,t.prototype.init=function(){return e},t.prototype.overlaps=function(e){return!1},t.prototype.update=function(t){return e},t.prototype.nodes=function(){return[]},t.prototype.clear=function(){return e},t}(),vt.Symbol=ut,at=function(){function t(n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P=this;e=this,p=["data","location","type","map"],c=["filter","tooltip","layout","group","click"];for(v=0,b=p.length;v<b;v++){h=p[v];if(n[h]==null)throw"SymbolGroup: missing argument '"+h+"'";e[h]=n[h]}for(m=0,w=c.length;m<w;m++)h=c[m],n[h]!=null&&(e[h]=n[h]);r=e.type;if(r==null){Tt("could not resolve symbol type",e.type);return}A=r.props;for(g=0,E=A.length;g<E;g++)h=A[g],n[h]!=null&&(e[h]=n[h]);e.layers={mapcanvas:e.map.paper},O=r.layers;for(y=0,S=O.length;y<S;y++)u=O[y],f=t._layerid++,o="sl_"+f,u.type==="svg"?a=e.map.createSVGLayer(o):u.type==="html"&&(a=e.map.createHTMLLayer(o)),e.layers[u.id]=a;e.symbols=[];for(s in e.data)i=e.data[s],kt(e.filter)==="function"?e.filter(i)&&e.addSymbol(i):e.addSymbol(i);e.layoutSymbols(),M=e.symbols;for(C=0,x=M.length;C<x;C++)d=M[C],d.render();kt(e.tooltip)==="function"&&e.initTooltips();if(kt(e.click)==="function"){_=e.symbols;for(k=0,T=_.length;k<T;k++){d=_[k],D=d.nodes();for(L=0,N=D.length;L<N;L++)l=D[L],l.symbol=d,$(l).click(function(t){return t.stopPropagation(),e.click(t.target.symbol.data)})}}e.map.addSymbolGroup(e)}var e;return e=null,t.prototype.addSymbol=function(t){var n,r,i,s,o,u,a,f;e=this,n=e.type,r=e._evaluate(e.location,t),kt(r)==="array"&&(r=new vt.LonLat(r[0],r[1])),s={layers:e.layers,location:r,data:t,map:e.map},f=n.props;for(u=0,a=f.length;u<a;u++)i=f[u],e[i]!=null&&(s[i]=e._evaluate(e[i],t));return o=new n(s),e.symbols.push(o),o},t.prototype._evaluate=function(e,t){var n;return kt(e)==="function"?n=e(t):n=e},t.prototype.layoutSymbols=function(){var t,n,r,i,s,o,u,a,f,l;f=e.symbols;for(u=0,a=f.length;u<a;u++){s=f[u],n=s.location;if(kt(n)==="string"){l=n.split("."),t=l[0],i=l[1],r=e.map.getLayerPath(t,i);if(r==null){Tt("could not find layer path "+t+"."+i);continue}o=e.map.viewBC.project(r.path.centroid())}else o=e.map.lonlat2xy(n);s.x=o[0],s.y=o[1]}if(e.layout==="group")return e.groupLayout()},t.prototype.groupLayout=function(){var t,n;return e=this,(n=e.gsymbols)==null&&(e.gsymbols=[]),t=!0},t.prototype.initTooltips=function(){var t,n,r,i,s,o,u,a,f,l,c;e=this,i=e.tooltip,l=e.symbols;for(o=0,a=l.length;o<a;o++){r=l[o],t={position:{target:"mouse",viewport:$(window),adjust:{x:7,y:7}},show:{delay:20},content:{}},s=i(r.data),kt(s)==="string"?t.content.text=s:kt(s)==="array"&&(t.content.title=s[0],t.content.text=s[1]),c=r.nodes();for(u=0,f=c.length;u<f;u++)n=c[u],$(n).qtip(t)}},t.prototype.remove=function(){var t,n,r,i,s,o,u,a;e=this,o=e.symbols;for(i=0,s=o.length;i<s;i++){r=o[i];try{r.clear()}catch(f){Tt("error: symbolgroup.remove")}}u=e.layers,a=[];for(t in u)n=u[t],t!=="mapcanvas"?a.push(n.remove()):a.push(void 0);return a},t.prototype.onResize=function(){var t,n,r,i,s;e=this,e.layoutSymbols(),i=e.symbols,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.clear(),s.push(t.render());return s},t}(),at._layerid=0,vt.SymbolGroup=at,vt.Kartograph.prototype.addSymbols=function(e){return e.map=this,new at(e)},u=function(e){function t(e){var n,r,i,s;n=this,t.__super__.constructor.call(this,e),n.radius=(r=e.radius)!=null?r:4,n.style=(i=e.style)!=null?i:"",n.title=e.title,n["class"]=(s=e["class"])!=null?s:"bubble"}return Vt(t,e),t.prototype.overlaps=function(e){var t,n,r,i,s,o,u,a,f,l,c;return r=this,l=[r.x,r.y,r.radius],o=l[0],a=l[1],i=l[2],c=[e.x,e.y,e.radius],u=c[0],f=c[1],s=c[2],o-i>u+s||o+i<u-s||a-i>f+s||a+i<f-s?!1:(t=o-u,n=a-f,t*t+n*n>(i+s)*(i+s)?!1:!0)},t.prototype.render=function(e){var t;return t=this,t.path=t.layers.mapcanvas.circle(t.x,t.y,t.radius),t.update(),t.map.applyStyles(t.path),t},t.prototype.update=function(){var e,t;return e=this,e.path.attr({x:e.x,y:e.y,r:e.radius}),t=e.path,t.node.setAttribute("style",e.style),t.node.setAttribute("class",e["class"]),e.title!=null&&t.attr("title",e.title),e},t.prototype.clear=function(){var e;return e=this,e.path.remove(),e},t.prototype.nodes=function(){var e;return e=this,[e.path.node]},t}(ut),u.props=["radius","style","class","title"],u.layers=[],vt.Bubble=u,N=function(e){function t(e){var n,r,i,s,o,u;n=this,t.__super__.constructor.call(this,e),n.icon=(r=e.icon)!=null?r:"",n.offset=(i=e.offset)!=null?i:[0,0],n.iconsize=(s=e.iconsize)!=null?s:[10,10],n["class"]=(o=e["class"])!=null?o:"",n.title=(u=e.title)!=null?u:""}return Vt(t,e),t.prototype.render=function(e){var t,n;return n=this,t=n.map.container,n.img=$("<img />"),n.img.attr({src:n.icon,title:n.title,alt:n.title,width:n.iconsize[0],height:n.iconsize[1]}),n.img.addClass(n["class"]),n.img.css({position:"absolute","z-index":1e3,cursor:"pointer"}),n.img[0].symbol=n,t.append(n.img),n.update()},t.prototype.update=function(){var e;return e=this,e.img.css({left:e.x+e.offset[0]+"px",top:e.y+e.offset[1]+"px"})},t.prototype.clear=function(){var e;return e=this,e.img.remove(),e},t.prototype.nodes=function(){var e;return e=this,[e.img]},t}(vt.Symbol),N.props=["icon","offset","class","title","iconsize"],N.layers=[],vt.Icon=N,ot=function(e){function t(e){var n,r,i,s,o;n=this,t.__super__.constructor.call(this,e),n.text=(r=e.text)!=null?r:"",n.style=(i=e.style)!=null?i:"",n["class"]=(s=e["class"])!=null?s:"",n.offset=(o=e.offset)!=null?o:[0,0]}return Vt(t,e),t.prototype.render=function(e){var t,n;return n=this,n.lbl=t=n.layers.mapcanvas.text(n.x,n.y,n.text),n.update(),n},t.prototype.update=function(){var e;return e=this,e.lbl.attr({x:e.x+e.offset[0],y:e.y+e.offset[1]}),e.lbl.node.setAttribute("style",e.style),e.lbl.node.setAttribute("class",e["class"])},t.prototype.clear=function(){var e;return e=this,e.lbl.remove(),e},t.prototype.nodes=function(){var e;return e=this,[e.lbl.node]},t}(vt.Symbol),ot.props=["text","style","class","offset"],ot.layers=[],vt.Label=ot,T=function(e){function t(e){var n,r,i,s;n=this,t.__super__.constructor.call(this,e),n.text=(r=e.text)!=null?r:"",n.style=(i=e.style)!=null?i:"",n["class"]=(s=e["class"])!=null?s:""}return Vt(t,e),t.prototype.render=function(e){var t,n,r;return r=this,t=$("<div>"+r.text+"</div>"),t.css({width:"50px",position:"absolute",left:"-25px","text-align":"center"}),r.lbl=n=$('<div class="label" />'),n.append(t),r.layers.lbl.append(n),t.css({height:t.height()+"px",top:t.height()*-0.4+"px"}),r.update(),r},t.prototype.update=function(){var e;return e=this,e.lbl.css({position:"absolute",left:e.x+"px",top:e.y+"px"})},t.prototype.clear=function(){var e;return e=this,e.lbl.remove(),e},t.prototype.nodes=function(){var e;return e=this,[e.lbl[0]]},t}(vt.Symbol),T.props=["text","style","class"],T.layers=[{id:"lbl",type:"html"}],vt.HtmlLabel=T,W=function(e){function n(e){var r,i,s,o,u,a,f,l,c,h;t=this,n.__super__.constructor.call(this,e),t.radius=(i=e.radius)!=null?i:4,t.styles=(s=e.styles)!=null?s:"",t.colors=(o=e.colors)!=null?o:["#3cc","#c3c","#33c","#cc3"],t.titles=(u=e.titles)!=null?u:["","","","",""],t.values=(a=e.values)!=null?a:[],t.border=(f=e.border)!=null?f:!1,t.borderWidth=(l=e.borderWidth)!=null?l:2,t["class"]=(c=e["class"])!=null?c:"piechart",(h=(r=Raphael.fn).pieChart)==null&&(r.pieChart=pt)}var t;return Vt(n,e),t=null,n.prototype.overlaps=function(e){var n,r,i,s,o,u,a,f,l,c;return l=[t.x,t.y,t.radius],o=l[0],a=l[1],i=l[2],c=[e.x,e.y,e.radius],u=c[0],f=c[1],s=c[2],o-i>u+s||o+i<u-s||a-i>f+s||a+i<f-s?!1:(n=o-u,r=a-f,n*n+r*r>(i+s)*(i+s)?!1:!0)},n.prototype.render=function(e){var n;return t=this,t.border!=null&&(n=t.layers.mapcanvas.circle(t.x,t.y,t.radius+t.borderWidth).attr({stroke:"none",fill:t.border})),t.chart=t.layers.mapcanvas.pieChart(t.x,t.y,t.radius,t.values,t.titles,t.colors,"none"),t.chart.push(n),t},n.prototype.update=function(e){var n;return},n.prototype.clear=function(){var e,n,r,i;t=this,i=t.chart;for(n=0,r=i.length;n<r;n++)e=i[n],e.remove();return t},n.prototype.nodes=function(){return[t.path.node]},n}(ut),W.props=["radius","values","styles","class","titles","colors","border","borderWidth"],W.layers=[],vt.PieChart=W,pt=function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g;if(isNaN(e)||isNaN(t)||isNaN(n))return[];l=this,h=Math.PI/180,a=l.set(),p=function(e,t,n,r,i,s){var o,u,a,f;return o=e+n*Math.cos(-r*h),u=e+n*Math.cos(-i*h),a=t+n*Math.sin(-r*h),f=t+n*Math.sin(-i*h),l.path(["M",e,t,"L",o,a,"A",n,n,0,+(i-r>180),0,u,f,"z"]).attr(s)},u=-270,d=0,c=function(i){var f,l,c,h,v,m,g;g=r[i],f=360*g/d,m=u+f*.5,l=s[i],h=500,c=30,v=p(e,t,n,u,u+f,{fill:l,stroke:o,"stroke-width":1}),v.mouseover(function(){v.stop().animate({transform:"s2.1 2.1 "+e+" "+t},h,"elastic")}),v.mouseout(function(){v.stop().animate({transform:""},h,"elastic")}),u+=f,a.push(v)};for(m=0,g=r.length;m<g;m++)v=r[m],d+=v;for(f in r)c(f);return a},drawStackedBars=function(e,t,n,r,i,s,o,u){function l(e,t,n,r,i){return a.rect(e,t,n,r).attr(i)}var a=this,f=this.set(),c=0,h=0,p=function(s){var a=i[s],p=r*a/h,d=e-n*.5,v=t+r*.5-c,m=n,g=o[s],y=500,b=30,w=l(d,v-p,m,p,{fill:g,stroke:u,"stroke-width":1});c+=p,w.mouseover(function(){w.stop().animate({transform:"s1.1 1.1 "+e+" "+t},y,"elastic")}).mouseout(function(){w.stop().animate({transform:""},y,"elastic")}),f.push(w)};for(var d=0,v=i.length;d<v;d++)h+=i[d];for(d=0;d<v;d++)p(d);return f},it=function(e){function t(e){var n,r,i,s,o,u,a,f,l,c;n=this,t.__super__.constructor.call(this,e),n.styles=(i=e.styles)!=null?i:"",n.colors=(s=e.colors)!=null?s:[],n.titles=(o=e.titles)!=null?o:["","","","",""],n.values=(u=e.values)!=null?u:[],n.width=(a=e.width)!=null?a:17,n.height=(f=e.height)!=null?f:30,n["class"]=(l=e["class"])!=null?l:"barchart",(c=(r=Raphael.fn).drawStackedBarChart)==null&&(r.drawStackedBarChart=drawStackedBars)}return Vt(t,e),t.prototype.overlaps=function(e){var t,n,r,i,s,o,u,a,f,l,c;return r=this,l=[r.x,r.y,r.radius],o=l[0],a=l[1],i=l[2],c=[e.x,e.y,e.radius],u=c[0],f=c[1],s=c[2],o-i>u+s||o+i<u-s||a-i>f+s||a+i<f-s?!1:(t=o-u,n=a-f,t*t+n*n>(i+s)*(i+s)?!1:!0)},t.prototype.render=function(e){var t,n,r,i,s,o;return r=this,i=r.width,n=r.height,s=r.x,o=r.y,t=r.layers.mapcanvas.rect(s-i*.5-2,o-n*.5-2,i+4,n+4).attr({stroke:"none",fill:"#fff"}),r.chart=r.layers.mapcanvas.drawStackedBarChart(r.x,r.y,r.width,r.height,r.values,r.titles,r.colors,"none"),r.chart.push(t),r},t.prototype.update=function(){var e,t;e=this;return},t.prototype.clear=function(){var e,t,n,r,i;e=this,i=e.chart;for(n=0,r=i.length;n<r;n++)t=i[n],t.remove();return e.chart=[],e},t.prototype.nodes=function(){var e;return e=this,[e.path.node]},t}(vt.Symbol),it.props=["values","styles","class","titles","colors","width","height"],it.layers=[],vt.StackedBarChart=it}).call(this);